# 计算机网络

### 第一章 计算机网络体系结构

**计算机网络体系结构**

- 计算机网络概述
  - 概念、组成、功能、分类
  - 标准化工作及相关知识
  - `性能指标`
- 体系结构和参考模型
  - 分层结构
  - 协议、接口、服务
  - `ISO/OSI模型`（本质上是OSI模型，由ISO组织制定）
  - `TCP/IP协议`

#### 概念和功能

**计算机网络：**是将一个分散的、具有独立功能的==计算机系统==，提供==通信设备==与==线路==连接起来，由功能完善的==软件==实现`资源共享`和`信息传递`的功能。



计算机网络是`互联`、`自治`的计算机集合。

- `互联`——通过通信链路互联互通
- `自治`——无主从关系（终端和结点）

![image-20230516151857202](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161518373.png)

**计算机网络的功能：**

- 数据通信
-  资源共享——同一台计算机网络上的其他计算机可以使用某台计算机的计算机资源的行为，可共享`硬件`、`软件`、`数据`。

- 分布式处理——多台计算机各自承担同一工作的不同部分  如`Hadoop平台`。
- 提高可靠性
- 负载均衡——多台计算机承载同一任务，效率更高。

**计算机网络的发展**

==第一阶段==

 美国国防部高级研究计划局（ARPA）设计一个分散的指挥系统——==ARPAnet-阿帕网==，但是阿帕网只可以连接相同类型的网络，随着网络的发展，希望实现不同网络之间的互联。故在`1983`年阿帕网接受`TCP/IP`协议，选定`Internet`为主要的计算机通信系统。

`网络`是把许多计算机连接在一起，而`互联网`则把许多网络连接在一起。`因特网`是世界上最大的互联网。

==第二阶段==——`三级结构`

`1985`年起，美国国家科学基金会NSF围绕6个大型计算机中心建设计算机网络，即国家科学基金网`NSFNET`。

**三级结构**

![image-20230516152045429](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161520617.png)

==第三阶段==——`多层次ISP结构`

**`ISP`**:==因特网服务提供者/因特网服务提供商==，是一个向广大用户综合提供互联网接入业务、信息业务和增值业务的公司。分为`主干ISP`、`地区ISP`、`本地ISP`。

![image-20230516152203439](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161522636.png)

##### 计算机网络的组成

**组成部分:**硬件、软件、协议（一系列规则和约定的集合）

**工作方式**

- 边缘部分（由端系统组成） 用户直接使用——`C/S方式`(Client/Server) 和 `P2P方式`(Peer—to—Peer )（==对等方式==）
- 核心部分（通过核心部分提供服务实现端系统之间的通信）==为边缘部分服务==

**功能组成**

- 通信子网  实现==数据通信==
- 资源子网  实现==资源共享==/数据处理

![image-20230427184539761](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304271845946.png)

##### 计算机网络的分类

**按分布范围分：**

- 广域网WAN   使用`交换技术`
- 城域网MAN
- 局域网LAN   使用`广播技术`
- 个人区域网PAN

**按使用者分：**

- 公用网
- 专用网

**按交换技术分：**

- 电路交换（在通信过程中独占资源）
- 报文交换——存储转发
- 分组交换——存储转发

**按拓扑结构分：**

- 总线型
- 星型
- 环形
- 网状型

![image-20230516152423920](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161524058.png)

**按传输技术分：**

- `广播式网络`——使用公共通信信道
- `点对点网络`——使用==分组存储转发==和==路由选择==机制

##### 标准化工作及相关组织

 **标准化工作**

**标准的分类：**

- `法定标准`——由权威机构制定的正式的、合法的标准  ==OSI==
- `事实标准`——某些公司的产品在竞争中占据了主流，时间长了，这些产品中的协议和技术就成了标准  ==TCP/IP==

==RFC==（Request For Comments）—— 因特网标准的形式



**RFC要上升成为因特网正式标准的`四个阶段`：**

- **因特网草案**（Internet Draft）这个阶段还不是 RFC 文档
- **建议标准** （Proposed Standard）从这个阶段开始成为 RFC 文档
- **草案建议**（Draft Standard）
- **因特网标准**（Internet Standard）

**相关组织：**

- **国际标准化组织ISO**——OSI模型、HDLC协议
- **国际电信联盟ITU**——制定通信规则
- **电气和电子工程师协会IEEE**——学术机构、IEEE802系列标准、5G
- **Internet工程师任务组IETF**——负责因特网相关标准的制定、RFC xxxx

##### 性能指标 —— 速率、带宽、吞吐量、时延、时延带宽积、往返时间RTT、利用率

**速率**

即`数据率`或称`数据传输率`或`比特率`

**定义：**连接在计算机网络上的==主机==在数字信道上传输数据==位数的速率==

**比特：**由 `1/0` 组成，单位是`位`

**速率的单位：**b/s，kb/s，Mb/s，Gb/s，Tb/s

![image-20230428093132989](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304280931163.png)



 **速率的单位换算：**

- 千   1kb/s = 10^3^b/s
- 兆   1Mb/s = 10^3^kb/s = 10^6^b/s
- 吉   1Gb/s = 10^3^Mb/s = 10^6^kb/s = 10^9^b/s
- 太   1Tb/s = 10^3^Gb/s = 10^6^Mb/s = 10^9^kb/s = 10^12^b/s

**存储容量的单位换算：**==1Byte（字节）= 8bit（比特）==

- 1KB = 2^10^B = 1024B = 1024 * 8b
- 1MB = 2^10^KB = 1024KB
- 1GB = 2^10^MB = 1024MB
- 1TB = 2^10^GB = 1024GB

**带宽**

`带宽`原本是指某个信号具有的频带宽度，即最高频率与最低频率之差，单位是赫兹（Hz）

- 在计算机网络中，`带宽`用来表示网络通信线路传输数据的能力，通常是指单位时间内从网络中的某一点到另一点所能通过的`最高数据率`。单位是`比特每秒`，b/s，kb/s，Mb/s，Gb/s.
- 也可以说==网络设备所支持的最高速度==

**吞吐量**

表示在`单位时间`内通过`某个网络（或信道、接口）`的数据量。单位b/s，kb/s，Mb/s等。

- 吞吐量受网络的带宽或网络的额定速率的限制。

**时延**

指数据（报文/分组/比特流）从网络（或链路）的一端传送到另一端所需要的时间。也叫`延迟`或`迟延`。单位是`s`。

- **发送时延**——从`发送分组`的第一个比特算起，到分组的最后一个比特发送完毕所需要的时间
  - **发送时延 = 数据长度/信道带宽（发送速率）**
- **传播时延**——取决于`电磁波传播速度`和`链路长度`
  - **传播时延 = 信道长度 / 电磁波在信道上的传播速率**
- **排队时延**——等待输出/入链路可用
- **处理时延**——检错，找出口

**时延带宽积**  

- **时延带宽积 = 传播时延 * 带宽**（单位 bit）

![image-20230516152552689](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161525866.png)

- 时延带宽积又称为以`比特为单位的链路长度`。即**“即某段链路现在有多少比特”**

**往返时延RTT**

**从发送方发送数据开始，到发送方收到接收方的确认**（接收方收到数据立即发送确认信息）**总共经历的时延**

- RTT越大，在收到确认前，可以发送的数据越多
-  RTT主要包括两个方面
  - **往返传播时延 = 传播时延 * 2**（最重要）
  - 末端处理时延

**利用率**

- **信道利用率**  ==有数据通过的时间 /（有 + 无）数据通过的时间==
- **网络利用率**   ==信道利用率加权平均值==

![image-20230428154125219](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304281541314.png)

#### 体系结构和参考模型

##### 分层结构   协议  接口  服务

**为什么要进行分层**？

发送文件前要完成的工作：

- 发起通信的计算机必须将数据通信的通路进行`激活`。
- 要告诉网络如何识别目的主机。
- 发起通信的计算机要查明目的主机是否开机，并且与网络连接正常。
- 发起通信的计算机要弄清楚对方计算机文件管理程序是否已经做好了准备工作。
- 确保差错和意外可以解决。
- ……

**由于一起完成所需工作量太大，需将一个大问题划分为多个小问题解决**

**分层的基本原则：**

- 各层之间相互`独立`，每层只实现一种相对独立的功能。
- 每层之间`界限自然清晰`，易于理解，相互之间交流尽可能少。
- 结构上可分隔开。每层都采用`最合适的技术`来实现。
- 保证`下层`对`上层`的独立性，**上层单向使用下层提供的服务**。
- 整个分层结构应该能促进标准化工作。

**分层结构**

![image-20230516152715241](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161527422.png)

**实体：**第 n 层的活动元素称为`n层实体`。同一层的实体叫`对等实体`。

**协议：**为进行网络中的`对等实体`数据交换而建立的规则、标准或约定称为网络协议（只有水平方向上才有协议）

- 语法：规定传输数据的格式
- 语义：规定所要完成的功能
- 同步：规定各种操作的顺序

**接口（访问服务点SAP）：**上层使用下层服务的入口。

**服务：**下层为相邻上层提供的功能调用（垂直方向上）

**SDU服务数据单元：**为完成用户所要求的功能而应传送的数据

**PCI协议控制信息：**控制协议操作的信息

**PDU协议数据单元：**对等层次之间传送的数据单位

**概念总结：**

- 网络体系结构是从`功能`上描述计算机网络结构。
- 计算机网络体系结构简称网络体系结构是`分层结构`。
- 每层遵循某个/些`网络协议`以完成本层功能。
- `计算机网络体系结构`是计算机网络的`各层及其协议`的集合。
- 第n层在向n+1层提供服务时，此服务不仅包括含第n层本身的功能，还包含由下层提供的功能。
- 仅仅在`相邻层间有接口`，且所提供服务的具体实现细节对上一层完全屏蔽。
- 体系结构是`抽象`的，而实现是指能运行的一些软件和硬件。

##### OSI参考模型

**来源**

**为了解决计算机网络复杂的大问题所提出了分层结构（按`功能`）**

IBM 公司第一个提出网络体系结构

**目的：**支持`异构网络系统`的互连互通。

国际标准化组织（ISO）于1984年提出开放系统互连（OSI）参考模型

**OSI 七层模型**

- 应用层
- 表示层
- 会话层
- 传输层
- 网络层
- 数据链路层
- 物理层

**ISO/OSI参考模型的通信过程**

![image-20230516153045211](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161530455.png)



![image-20230516153304826](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161533385.png)

**OSI参考模型各层说明：**

**应用层**

所有能和用户交互产生网络流量的程序

**典型应用层服务：**

- 文件传输（FTP）
- 电子邮件（SMTP）
- 万维网（HTTP）
- ……

**表示层**

用于处理在两个通信系统中交换信息的表示方式（语法和语义）

**主要功能：**

- 数据格式转换
- 数据加密解密
- 数据压缩和恢复

**会话层**

向表示层实体/用户进程提供`建立连接`并在连接上`有序`地`传输`数据。这是会话，也是`建立同步`（SYN）

**主要功能：**

- 建立、管理、终止会话
- 使用校验点可使会话在通信失效时从`校验点/同步点`继续恢复通信，实现数据同步。
  - 适用于传输大文件
  - 主要协议  ADSP、ASP

**传输层**

负责主机中`两个进程`的通信，即`端到端`的通信。传输单位是报文或用户数据报

**主要功能：**

- 可靠传输、不可靠传输
- 差错控制
- 流量控制
- 复用分用
  - 复用：多个应用层进程可以同时使用下面运输层的服务。
  - 分用：运输层把收到的信息分别交付给上面应用层中相应的进程。

**主要协议：**TCP、UDP

**网络层**

主要任务是把`分组`从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是`数据报`。

**主要功能：**

- 路由选择——最佳路径
- 流量控制
- 差错控制
- 拥塞控制
  - 若所有结点都来不及接收分组，而要丢弃大量分组的话，网络就处于`拥堵`状态。因此要采取一定措施，缓解这种拥堵。

**主要协议：**IP、IPX、ICMP、IGMP、ARP、RARP、OSPF

**数据链路层**

主要任务是把网络层传下来的数据报`组装成帧`。数据链路层的传输单位是`帧`。

**主要功能：**

- 成帧（定义帧的开始和结束）
- 差错控制  `帧错或位错`
- 流量控制
- 访问（接入）控制  `控制对信道的访问`

**主要协议：**SDLC、HDLC、PPP、STP

**物理层**

主要任务是在`物理媒体`上实现比特流的`透明传输`。物理层传输单位是`比特`。

==透明传输：==指不管所传数据是什么样的比特组合，都应当能够在链路上传送。

**主要功能：**

- 定义接口特性
- 定义传输模式——`单工、半双工、双工`
- 定义传输速率
- 比特同步
- 比特编码

**主要协议：**RJ45、802.3

##### TCP/IP模型

![image-20230516153413392](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161534561.png)

**OSI参考模型与TCP/IP参考模型的相同点：**

- 都分层
- 基于独立的协议栈的概念
- 可以实现异构网络的互联

**OSI参考模型与TCP/IP参考模型的不相同点：**

- OSI定义三点：服务、协议、接口

- OSI先出现，参考模型先于协议发明，不偏向于特定协议

- TCP/IP设计之初就考虑到`异构网络互联`问题，将IP作为重要层次

- |        | ISO/OSI参考模型 |   TCP/IP模型    |
  | :----: | :-------------: | :-------------: |
  | 网络层 | 无连接+面向连接 |     无连接      |
  | 传输层 |    面向连接     | 无连接+面向连接 |

  - `面向连接`分为三个阶段，第一阶段是建立连接，在此阶段，发出一个建立连接的请求，只有在连接成功建立之后，才能开始传输数据，这是第二阶段。第三阶段是当数据传输完毕，必须释放连接。
  - `面向无连接`没有这么多阶段，它直接进行数据传输。

**五层参考模型**——综合了OSI和TCP/IP的优点

- 应用层——支持各种网络应用  FTP、SMTP、HTTP
- 传输层——进程-进程的数据传输   TCP、UDP
- 网络层——源主机到目的主机的数据分组、路由转发 IP、ICMP、OSPF等
- 数据链路层——把网络层传下来的数据包组装成帧 
- 物理层

![image-20230516153506762](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161535973.png)

### 	第二章 物理层

**物理层**

- 通信基础
  - 基本概念
  - `两个公式`
    - 奈式准则
    - 香农定理
  - `编码与调制`
  - `数据交换方式`
    - 电路交换
    - 报文交换
    - 分组交换
- 传输介质&设备
  - 传输介质
    - 导向传输介质
    - 非导向传输介质
  - 物理层设备
    - 中继器
    - 集线器

#### 通信基础

##### 物理层的基本概念

**物理层的接口特性**

物理层解决如何在连接各种计算机的传输媒体上`传输数据比特流`，而不是指具体的传输媒体。

物理层的主要任务：确定与传输媒体`接口`有关的一些特性 ——> `定义标准`

**物理层所定义的特性：**

- **机械特性：**定义物理连接的特性，规定物理连接时所采用的规格、接口形状、`引线数目`、`引脚数目`和排列情况。
- **电气特性：**规定传输二进制位时，线路上信号的`电压范围`、阻抗匹配、传输`速率`和`距离限制`等。
- **功能特性：**指明某条线上出现的某一`电平表示何种意义`，接口部件的信号线的用途。
- **规程特性（过程特性）：**定义各条物理线路的工作`规程和时序`关系。

##### 数据通信的基础知识

**典型的数据通信模型**

![image-20230516153619586](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161536783.png)

**数据通信的相关术语：**

通信的目的是`传送消息`（消息：语音、文字、图像、视频等）。

**数据date：**传送信息的实体，通常是有意义的符号序列。

**信号：**数据的电气/电磁的表现，是数据在传输过程中的`存在形式`。

- `数字信号/离散信号：`代表消息的参数的取值是离散的。
- `模拟信号/连续信号：`代表消息的参数的取值是连续的。

**信源：**产生和发送数据的源头。

**信宿：**接收数据的终点。

**信道：**信号的传输媒介。一般用来表示向某一方向传送信息的介质。因此一条通信线路往往包含一条发送信道和一条接收信道。

- ==按传输信号分==——`模拟信道`（传送模拟信号） `数字信道`（传送数字信号）
- ==按传输介质分==——`无线信道`  `有线信号`

##### 三种通信方式

- `单工通信`——只有一个方向的通信而没有反方向的交互，仅需要`一条`信道。
- `半双工通信/双向交替通信`——通信的双方都可以发送或接收信息，但是任何一方都不能同时发送和接收，需要`两条`信道。
- `全双工通信/双向同时通信`——通信双方都可以同时发送和接收信息，也需要`两条`信道。

**串行传输&并行传输**

- **串行传输：**将表示一个字符的8位二进制数按由低位到高位的顺序依次发送。==速度慢、费用低、适合远距离传输==

![image-20230430145718680](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301457784.png)

- **并行传输：**将表示一个字符的8位二进制数同时通过8条信道发送。==速度快、费用高、适合近距离==

![image-20230430145753844](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301457929.png)

**同步传输&异步传输**

**同步传输：**在同步传输模式下，数据的传送是以一个`数据区块`为单位，因此同步传输又称为区块传输。在传送数据时，需先送出1个或多个同步字符，再送出整批的数据。（接收方在发现同步字符后就知道准备接收，==实现了发送方和接收方的时钟同步==）

![image-20230430145303255](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301453358.png)

**异步传输：**异步传输将比特分成小组进行传送，小组可以是8位的1个字符或更长。发送方可以在任何时刻发送这些比特组，而接收方不知道它们会在什么时候到达。传送数据时，加一个字符起始位和一个字符终止位。

![image-20230430145634459](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301456549.png)

##### 码元、速率、波特、带宽

**码元**

**码元**是指用一个`固定时长`的`信号波形`（数字脉冲），代表不同离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号称为k进制码元，而该时长称为码元宽度。当码元的离散状态有M个时（M大于2）,此时码元为M进制码元。

**1码元可以携带多个比特的信息量**。例如，在使用二进制编码时，只有两种不同的码元，一种代表0状态，另一种代表1状态。

![image-20230516153758003](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161537149.png)

**数字通信系统数据传输速率的两种表示方法**

速率也叫数据率，是指数据的`传输速率`，表示单位时间内传输的数据量。可以用`码元传输速率`和`信息传输速率`表示。

- **码元传输速率：**也被称为`码元速率`、`波形速率`、`调制速率`、`符号速率`等，它表示单位时间内数字通信系统所传输的码元个数（也可称`脉冲个数或信号变化的次数`）,单位是==波特==（Baud）。1波特表示数字通信系统每秒传输一个码元。

数字信号有多进制和二进制之分，但==码元速率与进制数无关==，只与==码元长度T==有关。

![image-20230430152425936](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301524018.png)

- **信息传输速率：**也称`信息速率`、`比特率`等，表示单位时间内数字通信系统传输的二进制码元个数（即比特数），单位是比特/秒（b/s）。

==关系：==若一个码元携带 n bit 的信息量，则 M Baud 的码元传输速率所对应的信息传输速率为M * n bit/s。

**带宽**

**模拟信号系统中：**当输入的信号频率高或低到一定程度，使得系统的输出功率成为输入功率的一半时（即-3dB）。最高频率和最低频率间的差值就代表了系统的通频带宽，其单位为`赫兹（Hz）`。

**数字设备中：**表示在单位时间内从网络的某一点到另一点所能通过的“**最高数据率**” 或 单位时间内通过链路的数量，常用来表示网络的通信线路所能传输数据能力。单位是`比特每秒（b/s）`。

![image-20230430153409557](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301534690.png)

##### 奈式准则和香农定理

**失真**

![image-20230516153914698](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161539051.png)

影响失真程度的因素：`码元传输速率`、`信号传输距离`、`噪声干扰`、`传输媒体质量`

**失真的一种情况**——==码间串扰==

![image-20230516174355366](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230516174355366.png)

码间串扰：==接收端==收到的信号波形==失去了码元之间清晰界限==的现象。（**发生在高频率下**）

**奈式准则**（奈奎斯特定理）

奈式准则：在理想低通（无噪声、带宽受限）条件下，为了避免码间串扰，极限码元传输速率为2W Baud，W 是信道带宽，单位是 Hz。

==理想低通信道下的极限数据传输率 = 2Wlog~2~V（b/s）== （其中 V 为几种码元/码元的离散电平数目）

- 在任何信道中，`码元传输的速率是有上限的`。若传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的完全正确识别成为不可能。
- 信道的`频带越宽`（即能通过的信号高频分量越多），就可以用更高的速率进行码元的有效传输。
- ==奈式准则给出了码元传输速率的限制，但并没有对信息传输速率给出限制==
- 由于码元的传输速率受奈式准则的制约，所以要提高数据的传输速率，就必须设法使每个码元能携带更多比特的信息量，这就需要采用多元制的调制方法。

**香农定理**

**噪声**存在于所有的电子设备和通信信道中，由于噪声的随机产生，它的瞬时性有时会很大，因此噪声会使接收端对码元的判决产生错误。但是噪声的影响是相对的，若信号较强，那么噪声影响相对较小。因此，`信噪比`就很重要。

信噪比 = **信号**的平均功率/**噪声**的平均功率，常记为S/N，并用分贝（dB）作为度量单位，即：

`信噪比(dB)` = ==10log~10~（S/N）==（`数值等价`）

香农定理：在带宽受限且有噪声的信道中，为了不产生误差，信息的数据传输速率有上限值。

`信道的极限数据传输速率` = ==Wlog~2~(1 + S/N) (b/s)==（其中S/N为信噪比）

- 信道的**带宽**或信道的**信噪比**越高，则信息的极限传输速率就**越高**。
- 对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了。
- 只要信息的传输速率低于信道的极限传输速率，就一定能找到某种方法来实现`无差错的传输`。
- 香农定理得出的为极限信号传输速率，实际信道能达到的传输速率要比它低不少。

##### 编码&调制

**基带信号和宽带信号**

==信道上传送的信号：==

- `基带信号`

  将数字信号1和0直接用两种不同的电压表示，再送到`数字信道`上去传输（==基带传输==）。**来自信源**的信号：像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。基带信号就是发出的**直接表达了要传输的信息的信号**。说话的声波也是基带信号。

- `宽带信号`

  将基带信号进行调制后形成的频分复用模拟信号，再传送到`模拟信道`上去传输（==宽带传输==）。把基带信号经过`载波调制`后，把信号的**频率范围搬移**到**较高的频段**以便在信道上传输（即仅在一定频率范围内可以通过信道）。	

在传输距离较近时，计算机网络采用==基带传输==方式（近距离衰减小，信号内容不易发生变化）

在传输距离较远时，计算机网络采用==宽带传输==方式（远距离衰减大，即使信号变化大也能过滤出来基带信号）

数据——————> ==数字信号  编码==

数据——————>  ==模拟信号  调制==

![image-20230430164525957](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301645075.png)

**数字数据编码为数字信号的几种方式：**

- **非归零编码（NRZ）**

  编码容易实现，但没有检错功能，且无法判断一个码元的开始和结束，以至于收发双方**难以保持同步**。

- **曼彻斯特编码**

  将一个码元分成两个相等的间隔，前一个间隔为低电平，后一个间隔为高电平表示码元1；码元0相反，也可以采用相反的规定。该编码的特点是在每一个码元的中间出现电平跳变，位于中间的跳变既可以作为时钟信号（可用于同步），也可作数据信号，==但它所占的频带宽度是原始基带宽度的两倍==。每一个码元都被调成两个电平，所以==数据传输速率只有调制速率的1/2==。

- **差分曼彻斯特编码**

  `同 1 异 0`

  常用于局域网传输，其规则是：若码元为1，则前半个码元的电平与上一个码元的后半个码元的电平相同，若为0，则相反。改编码的特点是，在每个码元的中间，都有一次电平的跳转，可以实现自同步，且抗干扰性`强`于曼彻斯特编码。

- **归零编码（RZ）**

  信号电平在一个码元之内都要恢复到零。

- **反向不归零编码**

  信号电平翻转表示0，电平信号不变表示1.

- **4B/5B编码**

  比特流中插入额外的比特，用5个比特来编码4个比特的数据。编码效率为80%。

![image-20230430183403886](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301834003.png)

**数字数据调制为模拟信号**

数字数据调制技术在发送端将数字信号转换为模拟信号，而在接收端将模拟信号还原为数字信号，分别对应调制解调器的调制和解调过程。

![image-20230430185253629](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301852757.png)

**模拟数据编码为数字信号**

在计算机应用中，能够达到**最高保真水平**的就是`PCM`编码，它主要包括三步：抽样、量化、编码。

- **抽样：**对模拟信号进行周期性扫描，把时间上连续的信号变成时间上离散的信号。为了是所得的离散信号能无失真地代表被抽样的模拟数据，要使用采样定理进行采样：`f采样频率>=2f信号最高频率`。
- **量化：**把抽样取得的电平幅值按照一定的分级标度转化为对应的数字值。
- **编码：**把量化的结果转换为对应的二进制编码。

**模拟数据调制为模拟信号**

为了实现传输的有效性，可能需要较高的频率。这种调制方式还可以使用频分复用技术，充分利用带宽资源。（将信号调成高频的模拟信号）

##### 数据交换方式

- **电路交换**
- **报文交换**
- **分组交换**
  - **数据报方式**
  - **虚电路方式**

其中==报文交换==和==分组交换==都是采用`存储转发`的交换方式。

**电路交换**

![image-20230430191049411](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301910577.png)

**电路交换原理：**在数据传输期间，源结点与目的结点之间有一条由中间结点构成的专用物理连接线路，在数据传输结束之前，这条线路一直保持。

**电路交换的阶段：**

![image-20230430191342199](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301913356.png)

**特点：**`独占资源`，用户始终占用端到端的固定传输带宽，适用于远程批处理信息传输或系统间实时性要求高的大量数据传输的情况。

**优缺点：**

|                        电路交换的优点                        |                        电路交换的缺点                        |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
|                          传输时延小                          |                        建立连接时间长                        |
|                   数据顺序传输，无失序问题                   | 独占线路，即使通信线路空闲，也不能供其他用户使用，信道使用率低。 |
| 实用性强，双方一旦建立物理通路，便可以实时通信，适用于交互式会话类通信。 | 灵活性差，双方连接通路中的任何一点出了故障，必须重新拨号建立连接，不适应突发性通信。 |
| 全双工通信，没有冲突，通信双方有不同的信道，不会争用物理信道 |                无数据存储能力，难以平滑通信量                |
|                   适用于模拟信号和数字信号                   | 电路交换时，数据直达，不同类型、不同规格、不同速率的终端很难相互进行通信。 |
|            控制简单，电路的交换设备及控制比较简单            |    无法发现与纠正传输差错，难以在通信过程中进行差错控制。    |

**报文交换**

报文：报文（message）是网络中交换与传输的数据单元，即站点`一次性要发送的数据块`。报文包含了将要发送的完整的数据信息，其长短不一致，长度不限且可变。

![image-20230430192833803](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301928040.png)

**报文交换的原理：**

无需在两个站点间建立一条专用网络，其数据传输的单位是报文，传送过程采用==存储转发==的方式。

**优缺点：**

|                        报文交换的优点                        |                        报文交换的缺点                        |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
|    无需建立连接；无建立连接时延，用户可以随时发送数据报文    |         实时性差，不适合传输实时或交互式业务的数据。         |
|   动态分配线路，动态选择报文通过的最佳路径，可以平滑通信量   |                       只适用于数字信号                       |
| 提高线路可靠性，某条传输路径发生故障，可重新选择另一条路径传输 | 由于报文长度没有限制，而每个中间结点都要完整的接收传来的整个报文，这就要求网络中的每个结点有较大的缓冲区。为了降低成本，有时还要将数据存于磁盘上，大大增加了传送时延。 |
| 调高线路利用率，通信双方在不同的时间一段一段地部分占用这条物理通道，多个报文可共享信道。 |                                                              |
|        提供多目标服务：一个报文可同时发往多个目的地址        |                                                              |
| 在存储转发中容易实现代码的转换和速率匹配，甚至收发双方可以不同时处于可用状态。这样便于不同类型、规格和速度的计算机之间进行通信。 |                                                              |

**分组交换**

分组：大多数计算机网络都不能连续的传送任意长的数据，所以实际上网络系统把数据分割成小块，然后逐块地发送，这种小块称为分组。

![image-20230516174846160](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161748296.png)

==分组== = `小数据 + 控制信息（源地址、目的地址和编号）`

**分组转发的原理：**

分组交换与报文交换的工作方式基本相同，都采用存储转发方式，形式上的主要差别在于，分组交换网中要==限制所传数据的数据单位的长度==，一般为128B。发送结点首先对从终端设备发来的数据报文进行接收、存储，而后将报文划分成一定长度的分组，并以分组为单位进行传输和交换。接收结点将收到的分组组装成信息或报文。

**优缺点：**

|                        分组交换的优点                        |                        分组交换的缺点                        |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| 无建立时延，无需为通信双方预先建立一条专用通信线路，用户可随时发送分组。 | 尽管分组交换比报文交换的传输时延小，但仍存在存储转发时延，而且其节点交换机必须具有更强的处理能力。 |
| 线路利用率高，通信双方在不同的时间一段一段的部分占有这条物理通道，多个分组可共享信道。 | 每个分组都要加控制信息，一定程度上降低了通信效率，增加了处理时间。 |
| 简化了存储管理。因为分组的长度固定，相应的缓冲区大小也固定，在交换节点中存储器的管理通常被简化为对缓冲区的管理，相对比较容易。 | 当分组交换采用数据报服务时，可能出现失序、丢失或重复分组，分组到达目的节点时，要对分组按编号进行排序等工作，增加了麻烦。若采用虚电路服务，虽无失序问题，但有呼叫建立、数据传输和虚电路释放三个过程。 |
| 加速传输，后一个分组的存储可以和前一个分组的转发并行操作；传输一个分组比一份报文所需的缓冲区小，可以减少等待发送时间。 |                                                              |
|     减小出错几率和重发数据量，提高可靠性，减少传输时延。     |                                                              |
|          分组短小，适用于计算机之间突发式数据通信。          |                                                              |

**数据交换方式的选择：**

![image-20230516174951323](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161749467.png)

- 传送数据量大，且传送时间远大于呼叫时，选择`电路交换`。电路交换传输时延最小。
- 当端到端的通路有很多段的链路组成时，采用`分组交换`传送数据较为合适。
- 从信道利用率上看，`报文交换`和`分组交换`优于电路交换，其中`分组交换`比报文交换的时延小，尤其适合于计算机之间突发式的数据通信。

**分组交换——数据报方式**

![image-20230430195952389](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304301959528.png)

- 源主机**将报文分成多个分组**，依次发送到直接相连的结点。
- 结点A收到分组后，对每个分组**差错检测**和**路由选择**，不同分组的下一跳结点可能不同。
- 结点C收到分组p1后进行**差错检测**，若正确则向A发送**确认信息**。
- 所有分组到达主机B。

**数据报方式的特点：**

- **数据报方式**为网络层提供`无连接服务`。发送方可随时发送分组，网络中的结点可随时接收分组。
- 同一报文的不同分组到达目的结点时可能发生乱序、重复与丢失。
- 每个分组在传输过程中都必须携带源地址和目的地址以及分组号。
- 分组在交换结点存储转发时，需要排队等候处理，这会带来一定的时延。当通过交换结点的通信量较大或网络发生拥塞时，这种时延会大大增加，交换结点还可还可根据情况丢弃部分分组。
- 网络具有冗余路径，当某一交换节点或一段链路出现故障时，可相应的更新转发表，寻找另一条路径转发分组，对故障的适应能力强，适用于突发性通信，不适于长报文、会话式通信。

**分组交换——虚电路方式**

虚电路是数据报方式和电路交换方式结合。

**虚电路：**一条源主机到目的主机类似于电路的路径（**逻辑链接**），路径上所有结点都要维持这条虚电路的建立，都维持一张虚电路表，每一项记录了一个打开的虚电路信息。

![image-20230430201812237](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304302018364.png)

**虚电路方式的特点：**

- **虚电路方式**为网络层提供`连接服务`。源结点与目的结点之间建立一条逻辑连接，而非实际物理连接。
- 一次通信的所有分组都通过虚电路顺序传送，分组不需要携带源地址、目的地址等信息，只需包含**虚电路号**，相对数据报方式开销小，同一报文的不同分组到达目的结点时不会乱序、重复或者丢失。
- 分组通过虚电路上的每个结点时，结点只进行差错检测，不需要进行路由选择。
- 每个结点可能与多个结点之间建立多条虚电路，每条虚电路支持特定的两个端系统之间的数据传输，可以对两个数据端点的流量进行控制，两个端系统之间也可以有多条虚电路为不同的进程服务。
- 致命缺点：当网络中的某个结点或某条链路出现故障而彻底失效时，则所有经过该结点或该链路的虚电路将遭到破坏。

**对比：**

|                    |                         数据报服务                         |                        虚电路服务                        |
| :----------------: | :--------------------------------------------------------: | :------------------------------------------------------: |
|     连接的建立     |                            不要                            |                          必须有                          |
|      目的地址      |                 每个分组都有完整的目的地址                 | 仅在建立连接阶段使用，之后每个分组使用长度较短的虚电路号 |
|      路由选择      |              每个分组独立的进行路由选择和转发              |          属于同一条虚电路的分组按照同一路由转发          |
|      分组顺序      |                    不保证分组的有序到达                    |                    保证分组的有序到达                    |
|       可靠性       |           不保证可靠通信，可靠性由用户主机来保证           |                     可靠性由网络保证                     |
| 对网络故障的适应性 | 出故障的节点丢失分组，其他分组路径选择发生变化，可正常传输 |         所有经过故障的节点的虚电路均不能正常工作         |
| 差错处理和流量控制 |        由用户主机进行流量控制，不保证数据报的可靠性        |          可由分组交换网负责，也可由用户主机负责          |

#### 物理层传输介质

##### 传输介质及分类 

传输介质也称为传输媒体/传输媒介，它是数据传输系统中在发送设备和接收设备之间的**物理通路**。

传输介质

- 导向型传输介质  ——>电磁波被导向沿着固体媒介（铜线/光纤）传播。
- 非导向型传输介质  ——>自由空间，介质可以是空气、真空、海水等。

**导向型传输介质——双绞线**

双绞线是古老的，也是最常用的传输介质，它是由`两根`采用一定规则并排`绞合`、相互绝缘的**铜导线**组成。==绞合可以减少相邻导线间的电磁干扰==。

为了进一步提高抗电磁干扰能力，可在双绞线的外面加上一个由`金属丝`编织成的屏蔽层，这就是**屏蔽双绞线**（STP），无屏蔽层的双绞线称为**非屏蔽双绞线**（UTP）。

模拟传输和数字传输都可以使用双绞线，其通信距离一般为100米以内。

**导向型传输介质——同轴电缆**

同轴电缆由`导体铜质芯线`、`绝缘层`、`网状编制屏蔽层`和`塑料外层`构成。按特性阻抗数值的不同，通常将同轴电缆分为两类：50欧姆同轴电缆和75欧姆同轴电缆。其中，50欧姆同轴电缆主要用于传输基带数字信号，又称为**基带同轴电缆**，它在局域网中得到广泛应用；75欧姆同轴电缆主要用于传送宽带信号，又称为**宽带同轴电缆**，它主要用于有线电视系统。

**同轴电缆VS双绞线：**

由于外导体屏蔽层的作用，同轴电缆`抗干扰特性`比双绞线好，被广泛用于传输较高速率的数据，其`传输距离`更远，但`价格`比双绞线贵。

**导向型传输介质——光纤**

光纤通信是利用光导纤维（简称光纤）传递`光脉冲`来进行通信。有光脉冲表示1，无光脉冲表示0.可见光的频率大约是10^8^MHz，因此光纤通信系统的**带宽远远大于**目前其他各种传输媒体的带宽。

光纤主要由`纤芯（实心的）`和`包层`构成，光波通过纤芯进行传导，包层较纤芯有较低的折射率。

![image-20230430210210819](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304302102928.png)

![image-20230516175117514](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161751622.png)

|          |                 定义                 | 光源                       | 特点                       |
| :------: | :----------------------------------: | -------------------------- | -------------------------- |
| 单模光纤 | 一种在`横向模式`直接传输光信号的光纤 | `定向`性很好的`激光`二极管 | `衰耗小`，适合`远`距离传输 |
| 多模光纤 |     有`多种`传输光信号模式的光纤     | 发光二极管                 | `易失真`，适合`近`距离传输 |

**光线的特点：**

- 传输`损耗小`，中继距离长，对远距离传输特别经济。
- `抗雷电和抗电磁干扰性能好`。
- 无串音干扰，保密性好，也`不易被窃听或截取数据`。
- `体积小，重量轻`。

**非导向传输介质**

- **无线电波：**较强`穿透能力`，可传远距离，广泛应用于通信领域（如手机通信）

- **微波：**通信频率较高、频段范围宽，因此数据率很高。

  - 地面微波通信

  - 卫星通信

    优点：通信容量大、距离远、覆盖广、广播通信和多指通信

    缺点：传播时延长、受气候影响大、误码率高、成本高

- **红外线、激光：**把要传播的信号分别**转换为各自的信号格式**，即红外光信号和激光信号，再在空间中传播。

##### 物理层设备

- **中继器**
- **集线器**

**中继器**

**诞生原因：**由于存在损耗，在线路上传输的信号功率会逐渐衰减，衰减到一定程度将会造成信号失真，因此会导致接收错误。

**中继器的功能：**对信号进行`再生和还原`，对衰减信号进行放大，保持与原数据相同，以增加信号传输距离，延长网络的长度。

**中继器的两端：**两端的网络部分是网段，而不是子网，适用于完全相同的`两类`网络的互连，且两个网段速率要相同。

**5-4-3规则：**网络标准中都对信号的延迟范围作了具体的规定，因而中继器只能在规定的范围内进行，否则会网络故障。

**集线器**（多接口中继器）

**集线器功能：**对信号进行`再生，放大转发`，对衰减的信号进行放大，接着转发到其他所有（除输入端口外）处于工作状态的端口上，以增加信号传输的距离，延长网络的长度。不具备信号的定向传送能力，是一个共享式设备。

![image-20230430212747926](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202304302127043.png)

### 第三章 数据链路层

- **功能**
  - 封装成帧
  - 差错控制
    - 位错
      - 检验编码：重传帧
      - 纠错编码
    - 帧错：定时器、编号机制
  - `流量传输`——>滑动窗口
  - `可靠传输`——>滑动窗口
- **应用**
  - 两种链路/信道
    - 点对点（广域网）
    - 广播（局域网）
      - `介质访问控制`——>静态划分信道、动态划分信道
  - 链路层设备

#### 数据链路层的功能

##### 数据链路层的基本概念

`结点`：主机、路由器

`链路`：网络中的两个结点之间的**物理通路**，链路的传输介质主要有双绞线、光纤和微波。分为有线链路和无线链路。

`数据链路`：网络中两个结点之间的**逻辑通道**，把实现控制数据传输**协议**的硬件和软件加到链路上构成数据链路。

`帧`：链路层的协议数据单元，封装网络层数据报。

==数据链路层==负责通过一条链路从一个结点向另一个物理链路直接相连的相邻结点传送数据报。

**数据链路层功能的概述：**数据链路层在物理层提供服务的基础上**向网络层提供服务**，其最基本的服务是将网络层来的数据`可靠`的传输到相邻结点的目标网络层，其主要作用是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接改造成为`逻辑上无差错的数据链路`，是指对网络层表现为无差错的链路。

**主要功能：**

- 为网络层提供服务，`无确认无连接服务`（通信质量好，有线传输网络），==有确认无连接服务==，==有确认面向连接服务==（通信质量差的无线传输链路），**有连接一定有确认**。
- **链路管理**，即连接的建立，维持，释放。（面向有连接的服务）。
- **组帧**
- **流量控制**（限制发送方的流量传输）
- **差错检测**（帧错/位错）

##### 封装成帧&透明传输

**封装成帧**

![image-20230502165724998](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021657371.png)

`封装成帧`就是在一段数据的前后部分添加头部和尾部，构成一个帧。接收端在收到在物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别出帧的开始和结束。

帧的首部和尾部有很多控制信息，他们最重要的一个作用是：`帧定界`（确认帧的边界）

==帧同步==：**接收方**应当能从接收到的二进制比特流中区分出帧的起始和结束。

**组帧的四种方法：**

- 字符计数法
- 字符（节）填充法
- `零比特填充法`
- `违规编码法`

![image-20230502170458295](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021704423.png)

**透明传输**

==透明传输==是指不管传输什么样的比特组合，都应当能在链路上传送。因此，链路层就==“看不见”==有什么妨碍数据传输的东西。

当所传数据的比特组合含有恰巧与某一个控制信息一样时，就必须采取相应的措施，使接收方不会将这样的数据误认为是某种控制信息。这样才可以保证数据链路层的传输是透明的。

==1.字符计数法==

帧首部使用一个计数字段（第一个**字节**，八位）来标明帧内字符数。

![image-20230502171422655](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021714786.png)

缺点：如果一个字符发生错误，将导致后续所有帧出现错误。（==一般不用==）

==2.字符填充法==

![image-20230502171716353](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021717483.png)

- 当传送帧是由ASCII码组成的文本文件时，不管什么字符都可以放在帧里传过去，即`透明传输`。
- 当所传送的帧是由非ASCII码的文本文件组成时，就要采用==字符填充法来实现透明传输==。

![image-20230502172318051](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021723189.png)

==3.零比特填充法==

- 在发送端，扫描整个信息字段，只要出现连续5个1，就立即填入1个0.
- 在接收端接收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描。在发现连续5个1时，就把后面的一个0删除。

![image-20230502172439381](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021724499.png)

**优点：**保证了透明传输，在传送的比特流中可以传送连续任意比特组合，而不会引起对帧边界的错误判断。

==4.违规编码法==

![image-20230502172944053](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021729176.png)

由于曼彻斯特编码在一个码元内电平总是==由高到低或是由低到高==，故可以用`高-高`或`低-低`来定义帧的起始和边界。

**目前较普遍使用的帧同步法是比特填充法和违规编码法**。

##### 差错控制（检错编码）

总的来说，传输过程中的差错都是由**噪声**引起的。

==全局性==：由于线路本生电器特性所产生的**随机噪声**（热噪声），是信道固有的，随即存在的。

解决方法：提高信噪比来减少或避免干扰。

==局部性==：外界特定的短暂原因造成的**冲击噪声**，是产生差错的主要原因。

解决方法：通常利用编码技术来解决。

**差错：**

- `位错`：比特位出错，1 变为0， 0 变为 1.
- `帧错`：
  - 丢失
  - 重复
  - 失序

**差错控制方法：**

- `检错编码`
  - 奇偶校验码
  - 循环冗余码 CRC

- `纠错编码`
  - 海明码

==冗余编码==

在数据发送之前，先按某种关系**附加**上一定的**冗余位**，构成一个符合某一规则的码字后再发送。当要发生有效数据变化时，相应冗余位也随之变化，使码字遵从不变的规则。接收端根据收到码字是否符合原规则，从而判断是否出错。

==编码 VS 编码==

数据链路层编码和物理层的数据编码是`不同`的。物理层编码针对的是**单个比特**，解决传输过程中比特的同步等问题，如曼彻斯特编码。而数据链路层的编码针对的是**一组比特**，它通过冗余码的技术判断一组二进制比特串在传输过程中是否出现了差错。

**检错编码——奇偶校验码**（n-1 位信息元 1位校验元）

- 奇校验编码：==1 的个数位奇数==
- 偶校验编码：==1 的个数为偶数==

**奇偶校验码的特点：**只能检查出==奇数个比特错误，检错能力为50%==。

**差错检测——CRC循环冗余码**

==求解步骤==

**1.准备带传有效数据**

![image-20230502193413947](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021934108.png)

**2.每个组都加上冗余码构成帧再发送**

==r  = 生成多项式的位数 - 1==

![image-20230502193512421](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021935530.png)

==FCS帧检验序列计算方式==

![image-20230502193720387](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021937525.png)

**进行模2运算，也就是异或：`同 0 异 1`，所得余数就是 FCS **。

**3.接收端检验**

![image-20230502194115840](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021941952.png)

**FCS 的生成以及接收端CRC检验都是由硬件完成，处理很迅速，因此不会延误数据的传输**。

**CRC 只能做到对帧的无差错接收，并非可靠传输。所谓可靠传输，就是数据链路层发送端发什么，接收端就收什么**。



**纠错编码**

**纠错编码——海明码**

**工作流程：**

==1.确定校验码的位数r==——>==2.确定校验码和数据的位置==——>==3.求出校验码的值==——>==4.检错并纠错==

**海明距离：**

两个合法编码（码字）对应比特取值不同的比特数称为这两个码字的**海明距离（码距）**，在一个有效编码集中，任意两个合法编码（码字）的海明距离的最小值称为该编码集的**海明距离（码距）**。

![image-20230502195650033](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305021956174.png)

==如果检测 d 位错，需要的码距位 d + 1==

==如果纠正 d 位错， 需要的码距位 2d + 1==

**1.确定校验码位数 r **

数据/信息有 m 位，冗余码/校验码有 r 位 ——> 校验码共有 2^r^种取值 ——> =2^r^ >= m + r + 1

如：

==要发送的数据：D = 1100==

数据的位数 m = 4，满足不等式的最小 r = 3， 也就是 D = 1100的海明码应该有7位，其中原数据4位，校验码3位。

**2.确定校验码和数据的位置：**

D = 1100

![image-20230502200544697](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022005801.png)

**3.求出校验码的值：**

![image-20230502200820513](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022008708.png)

**4.检错并纠错**

![image-20230502201120717](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022011844.png)

可以看出检验发生了错误

==纠错方法：==

![image-20230502201403362](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022014512.png)

##### 流量传输与可靠传输机制

**数据链路层的流量控制：**

`较高的发送速度`和`较低的接收能力`的不匹配，会造成传输错误，因此流量控制也是数据链路层的一项重要工作。

数据链路层的流量控制是点对点的，而传输层的流量控制是端到端的。

`数据链路层`流量控制手段：接收方接收不下就不回复确认。

`传输层`流量控制手段：接收端给发送端一个窗口公告。

**流量控制的方法：**

- **停止-等待协议**——发送窗口大小 = 1，接收窗口大小 = 1
-  **后退 N 帧协议（GBN）**——发送窗口大小 > 1， 接收窗口大小 = 1
- **选择重传协议（SR）**—— 发送窗口大小 > 1，接收窗口大小 > 1

**可靠传输、滑动窗口、流量控制**

==可靠传输==：发送端发啥，接收端收啥。

==流量控制==：控制发送速率，使接收方有足够的缓冲空间来接收每一个帧。

==滑动窗口解决==

- 流量控制（收不下就不给确认，想法也发不了）
- 可靠传输（发送方自动重传）

**停止-等待协议**

**为什么要有停止-等待协议？**

除了==比特出差错==，底层信道还会出现丢包问题。为了实现流量控制。

`停止-等待`就是在发送完一个分组就停止发送，等待对方确认，在收到确认后再发送下一个分组。

`停等协议`应用于  无差错情况 & 有差错情况

**停等协议——无差错情况**

![image-20230502204613586](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022046849.png)

**停等协议——有差错情况**

==1.数据帧丢失或检测到帧出错==

![image-20230502204814346](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022048637.png)

==2.ACK丢失==

![image-20230502204918989](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022049172.png)

==3.ACK迟到==

![image-20230502205003430](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022050656.png)

==停等协议性能分析：==简单！`信道利用率低`

![image-20230502205203395](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305022052544.png)

**信道利用率：**

发送方在一个发送周期内，有效的发送数据所需要的时间占整个发送周期的比率。

信道利用率 = （L / C）/ T

L：T 时间内发送 L 比特数据；

C：发送方的数据传输率；

T：发送周期。

==信道吞吐率 = 信道利用率 * 发送方的发送速率==

**停等协议的弊端：**

发送方必须收到接收方的确认才可以发送消息，且每次只能那发送一条消息，信道利用率过低。因此解决这个问题，就需要选择==后退 N 帧协议（GBN）==和==选择重传协议 （SR）==。

**后退 N 帧协议（GBN）**

**后退N帧协议中的滑动窗口：**

发送窗口：发送方维持一组连续允许发送的帧的序号。

![image-20230504081404532](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305040814710.png)

接收窗口：接收方维持一组连续允许接收帧的序号。

**GBN发送方必须响应的三件事：**

==1.上层的调用==

上层要发送数据时，发送方先检查发送窗口是否已满，如果**未满**，则产生一个帧并将其发送，如果**窗口已满**，发送方需将数据返回给上层，暗示窗口已满，上层等一会再发。（在实际生活中，发送方可以缓存这些数据，窗口不满时再发送帧）。

==2.收到了一个ACK==

GBN协议中，对 n 号帧的确认采用`累计确认`的方式，标明接收方已经收到 n 号帧以及它之前的全部帧了。

==3.超时事件==

协议的名字为后退 N 帧/回退 N 帧，来源于出现丢失和时延过长帧时发送方的行为。就像在停等协议中一样，定时器将再次用于恢复数据帧或确认帧的丢失。如果出现超时，发送方将重传所有已经发送但还未被确认的帧。

**GBN接收方要做的事：**

1.如果正确且按序接收到 n 号帧，那么接收方为 n 号帧发送一个 ACK ，并将该帧中的数据部分交付给上层。

2.其余情况都丢弃帧，并为最近按序接收的帧重新发送 ACK 。接收方无需缓存任何失序帧，只需维护下一个按序接收的帧序号。

![image-20230505161431240](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051614445.png)

**滑动窗口的长度：**

如果采用 n 个比特对帧编号，那么发送窗口的尺寸 W~T~应满足：==1<= W~T~<=2^n^-1== 。如果发送窗口尺寸过大，就会使得接收方无法区分新帧和旧帧。

**GBN 协议性能分析：**

- 😁 因连续发送数据而提高了信道的利用率。
- 😅 在重传时必须把原来已经正确传送的数据帧重传，使传送效率降低。

**选择重传协议**

![image-20230505162358245](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051623366.png)

**SR 发送方必须要响应的三件事：**

==1.上层的调用==

从上层接收到数据后，SR 发送方检查下一个可用于该帧的序号，如果序号位于发送窗口内，则发送数据帧，否则，要么将数据**缓存**，要么**返回给上层**之后再传输。

==2.收到了一个 ACK==

如果收到 ACK ，加入该帧序号在窗口内，则 SR 发送方将那个被确认的帧标记为已接收。如果该帧序号是窗口的下界（左边界），则窗口向前（右）移动到具有最小序号的未确认帧处。如果窗口移动了并且有序号在窗口内未发送帧，则发送这些帧。

![image-20230505163332927](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051633009.png)

==3.超时事件==

每个帧都有自己的定时器，一个超时事件发生后**只重传一个帧**。

**SR 接收方要做的事：**

`来者不拒（窗口内的帧）`

SR 接收方将**确认一个正确接收的帧**而`不管其是否按序`。失序的帧将被`缓存`，并返回给发送方一个该帧的确认帧，直到所有帧都被接收到为止，这时才可以将一批帧按序交付给上层，然后**向前滑动窗口**。

![image-20230505164158476](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051641603.png)

**滑动窗口的长度：**

发送窗口最好等于接收窗口。（大了会溢出，小了没意义）

==W~Tmax~ = W~Rmax~ = 2^n-1^==

#### 信道划分介质访问控制

**数据传输时使用的两种链路：**

- **点对点链路：**两个相邻节点通过一条链路直接相连，没有其他结点。ppp协议，常用于`广域网`。
- **广播式链路：**所有主机共享通信介质。应用：早期的总线以太网、无线局域网，常用于`局域网`。典型拓扑结构：总线型、星型（逻辑总线型）。

**介质访问控制**就是采取一定的措施，使得两对节点之间的通信不会发生相互干扰的情况。

==介质访问控制==

- **静态划分信道**——`信道划分介质访问控制`
  - 频分多路复用 FDM
  - 时分多路复用 TDM
  - 波分多路复用 WDM
  - 码分多路复用 CDM

- **动态划分信道**
  - `轮询访问介质访问控制`——令牌传递协议
  - `随机访问介质访问控制`
    - ALOHA协议
    - CSMA协议
    - CSMA/CD协议
    - CSMA/CA协议

##### 信道划分介质访问控制

将使用介质的每个设备与来自同一信道上的其他设备的**通信隔离开**，把`时域和频域资源`合理的分配给网络上的设备。

![image-20230505180634929](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051806067.png)

**多路复用技术：**把多个信号组合在一条物理信道上进行传输，使得多个计算机或终端设备`共享信道资源`，提高信道利用率。

**具体：**把一条广播信道，逻辑上分成几条用于两个节点之间通信的互不干扰的子信道，`实际上就是把广播信道转变为点对点信道`。

**频分多路复用 FDM**

![image-20230505181128425](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051811531.png)

用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。**频分复用的所有用户在同样的时间占用不同的带宽（频率带宽）资源**。

**优点：**充分利用传输介质带宽，系统**效率较高**；实现比较**容易**。

**时分多路复用 TDM**

![image-20230505181526233](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051815324.png)

将时间划分为一段段等长的时分复用帧（TDM帧）。每一个时分复用的用户在每一个TDM帧中占用**固定序号的时隙**，所有用户轮流占用信道。

==频分复用——并行==

==时分复用——并发==

**改进的时分复用——统计时分复用 STDM**

![image-20230505182138095](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051821199.png)

每一个 STDM 帧中时隙数**小于**连接在集中器上的用户数。各用户有了数据就随时发往集中器的`输入缓存`。然后集中器按顺序依次扫描输入缓存，一个 STDM 帧满了就发出。`STDM帧不是固定分配时隙，而是按需动态分配时隙`。

**波分多路复用 WDM**

波分多路复用就是**光的频分多路复用**，在一根光纤中传输多种不同波长（频率）的光信号，由于波长（频率）不同，所以各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来。

![image-20230505182920304](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051829416.png)

**码分多路复用 CDM**

**码分多址（CDMA）**是码分复用的一种方式。

1个比特分成多个码片/芯片（chip），每一个站点被指定一个唯一的m位的`芯片序列`，`发送1`时发送芯片序列（通常把0写成-1）。

发送1时站点发送芯片序列，`发送0`时发送`芯片序列反码`。

![image-20230505183548823](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051835924.png)

**求解步骤：**

1.多个站点同时发送数据的时候，要求各个站点`芯片序列相互正交`，**规格化内积**为0。

![image-20230505183754428](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051837514.png)

2.两个向量到了公共信道上，**线性相加**。

![image-20230505183854873](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051838956.png)

3.数据分离：合并数据和源站规格化内积。

![image-20230505184011725](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051840811.png)

**结果：**1代表S发送的是1，-1代表T发送的是0。

#### 动态分配信道

`动态媒体接入控制/多点接入`

特点：信道并非在用户通信时固定分配给用户。

##### 随机访问介质访问控制

所有用户可随机发送信息，发送消息时占`全部带宽`。

**ALOHA协议**

- 纯 ALOHA协议
- 时隙 ALOHA 协议

**纯 ALOHA 协议：**不监听信道，随机重发。`想发就发`

![image-20230505190854518](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051908647.png)

==冲突如何检测？==

如果发生冲突，接收方会检测出错误，然后不予理会，发送方在一定时间内收不到接收方的消息就判断发生冲突。

==冲突如何解决？==

超时后等一随机时间后再重新发送。

**时隙 ALOHA 协议：**把时间分成若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送。

![image-20230505191417932](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051914033.png)

**要点：**

- 纯 ALOHA 比时隙 ALOHA 吞吐量更低，效率更低。
- 纯 ALOHA 想发就发，时隙 ALOHA 只有在时间片段开始时才能发。

**CSMA协议（载波监听多路访问协议）**

**CS：**载波侦听/监听，每一个站发送数据之前要检测一下总线上是否有其他计算机在发送数据。

> 当几个站同时在总线上发送数据时，总线上的信号**电压摆动值**将会增大（相互叠加）。当一个站检测的信号电压摆动值超过一定门限值后，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞，即发生了冲突。

**MA：**多点接入，表示许多计算机以多点接入的方式连接在一根总线上。

**协议思想：**发送帧前，**监听**信道。

- 信道空闲：`发送数据帧`
- 信道忙：`推迟发送`
- `1-坚持CSMA`、`非坚持CSMA`、`p-坚持CSMA`

**1-坚持CSMA**

坚持指的是对于监听信道`忙`之后的坚持。

1-坚持CSMA思想：如果一个主机要发送消息，那么他先监听信道。

==ko空闲则直接传输，不必等待==

==忙则一直监听，直到空闲马上传输==

如果有冲突（一段时间内未收到肯定答复），则随即等待一个时间后再监听，重复上述过程。

**优点：**只要媒体空闲，站点就马上发送，避免了媒体利用率的损失。

**缺点：**如果有两个及以上的站点要发送数据，冲突就不可避免。

**非坚持CSMA**

非坚持指的是对于监听信道`忙`之后就不继续监听。

非坚持CSMA思想：如果一个主机要发送消息，那么它先监听信道。

==空闲则直接传输，不必等待==

==忙则等待一个随机的时间之后再进行监听==。

**优点：**采用随机重发延迟时间可以减少冲突发生的可能性。

**缺点：**可能存在大家都在延迟等待的过程中，使得媒体仍可能处于空闲状态，媒体使用率降低。

**p-坚持CSMA**

p-坚持指的是对于信道空闲的处理

p-CSMA思想：如果一个主机要发送消息，那么它先监听信道。

==空闲则以p概率直接传输，不必等待；概率1-p等待到下一个时间槽再传输==。

==忙则持续监听直到信道空闲再以p概率发送信息==。

==若冲突则等到下一个时间槽开始再监听并重复上述过程==。

**优点：**既能像非坚持算法那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间。

**缺点：**发生冲突后还是要坚持把数据帧发送完，造成了浪费。

**三种CSMA对比**

|              |  1-坚持CSMA  |           非坚持CSMA           |             p-坚持CSMA              |
| :----------: | :----------: | :----------------------------: | :---------------------------------: |
| ==信道空闲== |    马上发    |             马上发             |             p概率马上发             |
|  ==信道忙==  | 继续坚持监听 | 放弃监听，等一个随机时间再监听 | 持续监听，直到信道空闲再以p概率发送 |



🕵️‍♀️🕵️‍♀️🕵️‍♂️**CSMA/CD协议**

`载波监听多点接入/碰撞检测`

**CS：**载波侦听/监听，每一个站在`发送数据之前`以及`发送数据时`都要检测以下总线上是否有其他计算机在发送数据。

**MA：**多点接入，表示许多计算机以多点接入的方式连接在一根总线上。

**CD：**碰撞检测（冲突检测），“`边发送边监听`”，适配器边发送数据边检测信道上信号电压的变化情况。

**传播时延对载波监听的影响：**

![image-20230505195223169](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305051952291.png)

**如何确定碰撞后的重传时机：**

==截断二进制指数退避算法==

- 确定基本退避（推迟）时间为争用期 2t（t为单向传播时延）。
- 定义参数k，它等于重传次数，但 k 不超过10，即k = min[重传次数，10].当重传次数不超过10时，k等于重传次数，当重传次数大于10时，k 就不会一直增大而一直等于10。
- 从离散的整数集合[0，1，2^k^-1]中随机取出一个数 r ，重传所需要退避的时间就是**r倍的基本退避时间**，即 `2rt`。
- 当重传达`16次`仍不能成功时，说明网络太拥挤，认为此帧永远无法正确发出，抛弃此帧并向高层报告。

**最小帧长问题：**

如果帧的长度太短，即使发生碰撞可能也检测不出来。

帧的传输时延至少要两倍于信号在总线中的传播时延。

帧长（bit）/数据传输速率 >= 2t

==最小帧长== = 总线传播时延 * 数据传输速率 * 2

> 以太网规定最短帧长为64B，凡是长度小于64B的都是由于冲突而异常终止的无效帧。

**CSMA/CD过程总结：**

==1.准备发送==

适配器从网络层获得一个分组，封装成帧，放入适配器的缓存芯片中等待发送。发送之前，先检测信道。

==2.检测信道==

若检测到信道忙，则不停的检测，一直等到信道转为空闲，并在96bit时间内一直保持空闲（保证了帧的最小间隔），就发送数据。

==3.边发送边监听，在发送过程中不停的检测信道==

（1）成功发送：

即在争用期内一直未检测到碰撞，这个帧必定能够成功发送，发送完毕后什么也不做，继续返回准备发送步骤。

（2）发送失败：

即在争用期内检测到碰撞时，立即停止帧的发送，并按规定发送人为干扰信号。之后适配器按规定计算退避时间，等待 r * 2t 的时间后，再次检测信道并尝试发送（返回步骤2），若重传次数达到16次仍然不能成功发送，则停止重新发送并上报错误。

**CSMA/CA协议**

`载波监听多点接入/碰撞避免`

为什么要有CSMA/CA？

**无线局域网：**

- 无法做到360^o^全面检测碰撞
- 隐蔽站——当A和C都检测不到信号，认为信道空闲时，同时向终端B发送数据帧，就会导致冲突。

**CSMA/CA的工作原理：**

- 发送数据前，先检测信道是否空闲。
- 空闲则发出`RTS`（request to send），RTS包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息，信道忙则等待。
- 接收端收到RTS后，将响应`CTS`（clear to send）。
- 发送端收到CTS后，开始发送数据帧（同时`预约信道`：发送方告知其他站点自己要传多久数据）。
- 接收端收到数据帧后，将用CRC来检验数据帧是否正确，正确响应`ACK帧`。
- 发送方收到ACK就可以进行下一个数据帧的发送，若没有则一直重传至规定发送次数为止。

==1.预约信道——>2.ACK帧——>3.RTS/CTS帧（可选）==

**CSMA/CD与CSMA/CA对比：**

==相同点：==

CSMA/CD与CSMA/CA机制都从属于CSMA的思路，其核心是`先听再说`。换言之，两个再接入信道之前都需要进行监听。当发现信道空闲后，才能进行接入。

==不同点：==

**1.传输介质不同：**CSMA/CD用于总线式以太网（有线），而CSMA/CA用于无线局域网（无线）

**2.载波检测方式不同：**因**传输介质不同**，CSMA/CD与CSMA/CA的**检测方式也不同**。CSMA/CD通过电缆中电压的变化来检测，当数据发生碰撞时，电缆中的电压就会随之发生变化；而CSMA/CA采用能量检测（ED）、载波检测（CS）和能量载波检测三种检测信道空闲的方式。

**3.CSMA/CD检测冲突，CSMA/CA避免冲突，**二者出现冲突后都会进行`有上限的重传`。

##### 轮询访问介质访问控制

信道划分介质访问控制（`MAC` Multiple Access Control）协议：

- 基于**多路复用**技术划分资源。
- `网络负载重`：共享信道效率高，且公平。
- `网络负载轻`：共享信道效率低

随机访问MAC协议：==冲突==

- 用户根据意愿**随机**发送信息，发送信息时可独占带宽。
- `网络负载重`：产生冲突开销
- `网络负载轻`：共享信道效率高，单个节点可利用信道全部带宽

轮询访问MAC协议/轮流协议/轮转访问MAC协议：既**不产生冲突**，还能在发送时**占用全部带宽**。

**轮询协议：主结点轮流“邀请”**从属结点f发送数据。

![image-20230506185838931](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305061858098.png)

**令牌传递协议**

==令牌==：一个特殊格式的MAC控制帧，不含任何信息。控制信道使用，确保同一时刻只有一个节点独占信道。

==令牌环网无碰撞==

![image-20230506190221024](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305061902121.png)

每个结点都可以在一定时间内（令牌持有时间）获得发送数据的权利，并不是无限制的持有令牌。

应用令牌环网的网络（物理星型拓扑，逻辑环形拓扑）

采用令牌传送方式的网络常用于**负载较重、通信量较大**的网络中。

#### 局域网基本概念和体系结构

**局域网**：简称LAN，是指在**某一区域内**由多台计算机互联的计算机组，使用`广播信道`。

- 覆盖的地理范围较小，只在一个相对独立的局部范围内联，如一座或集中的建筑群内。
- 使用专门铺设的传输介质（双绞线、同轴电缆）进行联网，数据传输率高（10Mb/s~10Gb/s）。
- 通信延迟时间短，误码率低，可靠性较高。
- 各站为平等关系，共享传输信道。
- 多采用分布式控制和广播式通信，能进行广播和组播。

决定局域网的主要要素为：`网络拓扑`，`传输介质`与`介质访问控制方法`。

**局域网拓扑结构：**

- 星型拓扑
- 总线型拓扑
- 环形拓扑
- 树形拓扑

**局域网传输介质：**

- 有线局域网：==常用介质==：双绞线、同轴电缆、光纤
- 无线局域网：==常用介质==：电磁波

**局域网介质访问控制方法：**

- CSMA/CD：常用于==总线型局域网==，也用于树形网络
- 令牌总线：常用于==总线型局域网，也用于树形网络。他是把总线型或树形网络中的各个工作站按一定顺序如按接口地址大小排列形成一个逻辑环。只有令牌持有者才能控制总线，才有发送信息的权力。
- 令牌环：常用于==环形局域网==，如令牌环网

**局域网的分类：**

- **以太网**：以太网是应用最为广泛的局域网，包括标准以太网（10Mbps）、快速以太网（100Mbps）、千兆以太网（1000Mbps）和10G以太网，他们都符合IEEE802.3系列标准规范。逻辑拓扑总线型，物理拓扑是星型。使用CSMA/CD。
- **令牌环网**：物理上采用了星型拓扑结构，逻辑上环形拓扑结构。（已不适应现在网络）
- **FDDI网**：物理上采用了双环拓扑结构，逻辑上是环形拓扑结构。
- **ATM网**：较新型的单元交换技术，使用53字节固定长度的单元进行交换。
- **无线局域网**：采用IEEE802.3标准。

**IEEE 802标准：**

IEEE 802系列标准是IEEE 802 LAN/MAN标准委员会制定的局域网、城域网技术标准。其中最广泛使用的有以太网、令牌环、无线局域网等。这一系列标准中的每一个子标准都是由委员会中的一个专门工作组负责。

**MAC子层和LLC子层：**

IEEE 802 标准所描述的局域网参考模型只对应OSI参考模型的`数据链路层和物理层`，它是将数据链路层划分为逻辑链路层LLC子层和介质访问控制MAC子层。

![image-20230506193534717](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305061935832.png)

**以太网**

以太网（**Ethernet**）指的是由Xerox、Intel和DEC公司联合开发的`基带总线局域网规范`，是当今现有局域网采用的最通用的通信协议标准。以太网使用==CSMA/CD==（载波监听多点访问/冲突检测）技术。

**以太网在局域网各种技术中占统治性地位：**

- 造价低廉；
- 是应用最广泛的局域网技术；
- 比令牌环网、ATM网便宜，简单；
- 满足网络速率要求：10Mb/s~10Gb/s

**以太网的两个标准：**

- DIX Ethernet V2：第一个局域网产品（以太网）规约。
- IEEE 802.3：IEEE 802 委员会 802.3工作组制定的第一个 IEEE 的以太网标准。

**以太网提供无连接、不可靠服务：**

- 无连接：发送方和接收方之间无**握手过程**。
- 不可靠：不对发送方的数据帧**编号**，接收方不同时向发送方进行**确认**，差错帧直接丢弃，差错纠正由高层负责。

**以太网传输介质与拓扑结构的发展：**

==粗同轴电缆==——>==细同轴电缆==——>==双绞线+集线器==

**物理拓扑：**总线型——>星型

使用集线器的以太网在逻辑上仍然是一个总线网，各站共享逻辑上的总线，使用的还是CSMA/CD协议。

以太网拓扑：`逻辑`上是`总`线型，`物理`上`星`型。

**10BASE-T以太网**

10BASE-T是传送`基带信号`的双绞线以太网，T表示采用双绞线，现10BASE-T采用的是==无屏蔽双绞线==（UTP），传输速率是==10Mb/s==。

![image-20230506195359017](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305061953109.png)

- `物理上采用星型拓扑`，`逻辑上总线型`，每段双绞线最长`100m`。
- 采用`曼彻斯特编码`。
- 采用`CSMA/CD`介质访问控制。

**适配器与MAC地址：**

计算机与外界局域网的连接是通过`通信适配器`的。

在局域网中，硬件地址也称为物理地址或MAC地址。

**MAC地址：**每个适配器有一个全球唯一的48二进制地址，前24位代表厂家（由IEEE规定），后24位厂家自己指定。常用6个十六进制数表示。

**以太网MAC帧：**

最常用的MAC帧是以太网v2的格式：

![image-20230506200027224](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305062000318.png)

==高速以太网==

速率>=100Mb/s的以太网称为高速以太网。

- **100BASE-T以太网**

在`双绞线`上传送`100Mb/s基带信号`的`星型`拓扑以太网，仍使用IEEE802.3的`CSMA/CD`协议。

支持全双工和半双工，可在全双工方式下工作而无冲突。

- **吉比特以太网**

在`光纤或双绞线`上传送`1Gb/s信号`。

支持全双工和半双工，可在全双工方式下工作而无冲突。

- **10吉比特**

10吉比特以太网在`光纤`上传送`10Gb/s`信号。

只支持全双工，无争用问题。

##### IEEE 802.11无线局域网

IEEE 802.11是**无线局域网**通用的标准，它是由IEEE所定义的无线局域网通信的标准。

**802.11的 MAC帧头格式：**

![image-20230506201126410](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305062011509.png)

![image-20230506201223703](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305062012810.png)

**无线局域网的分类：**

- 有固定基础设施的无线局域网
- 无固定基础设施的无线局域网的自组织网络

##### ppp协议&HDLC协议

**广域网（WAN）**：通常跨接很大的物理范围，所覆盖的范围从几十公里到几千公里，它能连接多个城市或国家，或横跨几个州并能提供远距离通信，形成国际性的远程网络。

广域网的通信子网主要使用`分组技术`。广域网的通信子网可以利用公用分组交换网、卫星通信网和无线分组交换网，它将不同地区的**局域网或计算机系统**互连起来，达到`资源共享`的目的。如因特网（Internet）是世界范围内最大的广域网。

**ppp协议的特点：**

点对点协议ppp是目前使用最广泛的数据链路层协议，用户使用拨号电话接入因特网时一般都使用ppp协议。

==只支持全双工链路==。

**ppp协议应满足的要求：**

- **简单**——对于链路层的帧，无需纠错，无需序号，无序流量控制。
- **封装成帧**——帧定界符
- **透明传输**——与帧定界符一样比特组合的数据应该如何处理：异步线路用字节填充，同步线路用比特填充。
- **多种网络层协议**——封装的IP数据报可以采用多种协议。
- **差错检测**——错就丢弃
- **检测连接状态**——链路是否正常工作。
- **最大传送单元**——数据部分最大长度MTU
- **网络层地址协商**——知道通信双方的网络层地址
- **数据压缩协商**

**ppp协议的三个组成成分：**

- 一个将IP数据报封装到串行链路（同步串行/异步串行）的方法。
- 链路控制协议**LCP**：建立并维护数据链路连接。
- 网络控制协议**NCP**：ppp可支持多种网络层协议，每个不同的网络层协议都要一个相应的NCP来配置，为网络层协议建立和配置逻辑连接。

**ppp协议状态图：**

![image-20230506204308888](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305062043999.png)

**ppp协议的帧格式：**

![image-20230506204404710](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305062044810.png)

**HDLC协议**

高级数据链路控制（HDLC），是一个在同步网上传输数据、**面向比特**的数据链层协议，它是由国际标准化组织（`ISO`）根据IBM公司的SDLC协议扩展开发而成的。

数据报文可透明传输，用于实现透明传输的“0比特插入法”，易于硬件实现

==采用全双工通信==

所有帧采用**CRC检验**，对信息帧进行顺序**编号**，可防止漏收或重复，传输可靠性高。

**HDLC的站：**

==主站、从站、复合站==

- 主站的主要功能是发送命令（包括数据信息）帧、接收响应帧，并负责整个链路的控制系统的初启、流程的控制、差错检测或恢复等。
- 从站的主要功能是接收由主站发来的命令帧，向主站发送响应帧，并且配合主站参与差错恢复等链路控制。
- 复合站的主要功能是既能发送，又能接收命令帧和响应帧，并负责整个链路的控制。

==三种数据操作方式==

- 正常响应方式
- 异步平衡方式
- 异步响应方式

**HDLC的帧格式：**

![image-20230507152400118](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230507152400118.png)

==控制字段只看前两位==

- 如果第一位为`0`，则为信息帧，用来==传输数据信息==，或使用捎带技术对数据进行确认；
- 如果前两位为`10`，则为监督帧，用于==流量传输和差错控制==，执行对信息帧的确认、请求重发和请求暂停发送等功能；
- 如果前两位为`11`，则为无编号帧，用于提供对`链路`的建立、拆除等多种控制功能。

**PPP协议 & HDLC协议**

- HDLC、PPP都只支持`全双工`链路。
- 都可以实现透明传输；
- 都可以实现差错控制，但不纠正差错。

| PPP协议  | 面向字节 | 2B协议字段 | 无序号和确认机制 | 不可靠 |
| :------: | :------: | :--------: | :--------------: | :----: |
| HDLC协议 | 面向比特 |    没有    | 有编号和确认机制 |  可靠  |

![image-20230507153728047](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305071537167.png)

#### 链路层设备

##### 物理层扩展以太网

![image-20230507153909108](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305071539222.png)

![image-20230507153931628](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305071539730.png)

##### 链路层扩展以太网

`网桥`根据**MAC帧的目的地址**对帧进行**转发**和**过滤**。当网桥收到一个帧时，并不向所有接口转发此帧，而是先检查此帧的目的MAC地址，然后再确定将该帧转发到哪一个接口，或是把他丢弃掉。

![image-20230507154304521](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305071543650.png)

**网桥的优点：**

- 过滤通信量，增大吞吐量；
- 扩大了物理范围；
- 提高了可靠性；
- 可互联不同物理层、不同MAC子层和不同速率的以太网。

**网段：**一般指一个计算机网络中使用同一物理层设备（传输介质，中继器，集线器等）能够直接通讯的那一部分。

==透明网桥==

“透明”指以太网上的站点并不知道所发送的帧将经过哪几个网桥，是一种即插即用设备——自学习。

==源路由网桥==

在发送帧时，把详细的最佳路由信息放在帧的首部中。

==方法==：源站以广播方式向欲通信的目的站发送一个**发现帧**

##### 以太网交换机——多接口网桥

![image-20230507155128404](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305071551541.png)

**以太网交换机的两种交换方式：**

- **直通式交换机**

查完目的地址（6B）就立刻转发。

==延迟小==，可靠性低，无法支持具有不同速率的端口的交换。

- **存储转发式交换机**

将帧放入高速缓存，并检查是否正确，真确则转发，错误则丢弃。

延迟大，==可靠性高，可以支持具有不同速率的端口的交换==。

##### 冲突域和广播域

**冲突域：**在每一个冲突域中的每一个节点都能收到所有被发送的帧。简单来说就是同一时间内只能有一台设备发送信息的范围。

**广播域：**网络中能接收任一设备发出的广播帧的所有设备的集合。

|                              | 能否隔离冲突域 | 能否隔离广播域 |
| :--------------------------: | :------------: | :------------: |
| 物理层设备（中继器、集线器） |       否       |       否       |
|  链路层设备（网桥、交换机）  |       能       |       否       |
|     网络层设备（路由器）     |       能       |       能       |

### 第四章 网络层

==网络层==

- 概述和功能
- 转发
  - 深入硬件结构——路由器——转发表
  - 了解各种协议——IP、ARP、DHCP、ICMP
  - IPV4分组
  - 网络层编址
    - 基本编址形式
    - 子网划分与子网掩码
    - CIDR
  - 网络地址转换 NAT
  - IPV6
  - 移动 IP
- 路由选择
  - 路由选择算法
    - 静态路由
    - 动态路由
      - 距离向量路由算法
      - 链路状态路由算法
  - 路由选择协议（层次路由）
    - 自治系统内 IGP——RIP、OSPF
    - 自治系统间 EGP——BGP
  - IP组播

#### 概述和功能

##### 网络层的功能

主要任务是把`分组`从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是`数据报`。

==功能：==

- 路由选择与分组转发（寻找最佳路由）

- 异构网络互连

- 拥塞控制

  若所有节点都来不及接收分组，而要丢弃大量分组的话，网络就处于`拥塞`状态。因此要采取一定措施，缓解这种拥塞。

##### IP数据报格式

**TCP/IP协议栈：**

![image-20230509141008947](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091410158.png)

**IP数据报格式：**

![image-20230509141126620](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091411738.png)

![image-20230509141306053](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091413165.png)

==版本：==IPV4 / IPV6

==首部长度==：单位是`4B`，最小为5

==区分服务==：指示期望获得哪种类型的服务

==总长度==：首部 + 数据部分，单位是 `1B`

==标识==：同一数据报的分片使用同一标识符

==标志==：虽然有三位，但只有两位有意义。X__

==中间位DF==：DF = 1，禁止分片；DF = 0，允许分片。

==最低位MF==：MF = 1，代表后面还有分片；MF = 0，代表这是最后一片，后面没有了。

==片偏移==：分片在原分组中的相对位置，以`8B`为单位。（是分片的数据部分在原分组的相对位置，不算首部）

==生存时间（RTT）==：IP分组的保质期。经过一个路由器 -1，变为 0 时则丢弃。

==协议==：数据部分的协议

==首部检验和==：只检验首部

==可选字段==：0~40B，用来支持排错、测量以及安全等措施

==填充==：全 0 ，把首部补为4B的整数倍

##### IP数据报的分片

==最大传送单元 MTU==

数据链路层可封装数据的上限。以太网的 MTU 是 `1500`字节

如果所传送的数据长度超过某条链路的 MTU，则需要 `分片`

##### IPv4地址

**IP编址的历史阶段：**

- 分类的 IP 地址
- 子网的划分
- 构成超网（无分类编址方法）

**分类的IP地址：**

IP地址：全世界唯一的**32位/4字节**标识符，标识路由器主机的接口。

IP地址由{<网络号>，<主机号>}构成

![image-20230509143916050](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091439197.png)

**分类 IP 地址：**

![image-20230509144048095](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091440244.png)

**特殊的 IP 地址：**

| NetID网络号 | HostID主机号      | 作为IP分组源地址 | 作为IP分组目的地址 | 用途                                         |
| ----------- | ----------------- | ---------------- | ------------------ | -------------------------------------------- |
| 全0         | 全0               | 可以             | 不可以             | 本网范围内表示主机，路由器中用来表示默认路由 |
| 全0         | 特定值            | 可以             | 不可以             | 表示本网内某个特定主机                       |
| 全1         | 全1               | 不可以           | 可以               | 本网广播地址（路由器不转发）                 |
| 特定值      | 全0               | 不可以           | 不可以             | 网络地址，表示一个网络                       |
| 特定值      | 全1               | 不可以           | 可以               | 直接广播地址，对特定网络上的所有主机进行广播 |
| 127         | 任何值（非全0/1） | 可以             | 可以               | 用于本地软件环回测试，称为环回地址           |

**私有 IP 地址：**

| 地址类别 |          地址范围           | 网段个数 |
| :------: | :-------------------------: | :------: |
|   A类    |   10.0.0.0~10.255.255.255   |    1     |
|   B类    |  172.16.0.0~172.31.255.255  |    16    |
|   C类    | 192.168.0.0~192.168.255.255 |   256    |

| 网络类别 | 最大可用网络数 | 第一个可用的网络号 | 最后一个可用的网络号 | 每个网络中的最大主机数 |
| :------: | :------------: | :----------------: | :------------------: | :--------------------: |
|    A     |     2^7^-2     |         1          |         126          |        2^24^-2         |
|    B     |    2^14^-1     |       128.1        |       191.255        |        2^16^-2         |
|    C     |    2^21^-1     |      192.0.1       |     223.255.255      |         2^8^-2         |

##### 网络地址转换（NAT）

路由器对目的地址是私有IP地址的数据报一律不进行转发。

网络地址转换 **NAT（Network Address Translation）：**在`专用网`连接到`因特网`的路由器上安装 NAT 软件的路由器叫**NAT路由器**，它至少有一个有效的**外部全球IP地址**。

![image-20230509150359746](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091504100.png)

##### 子网划分与子网掩码

**分类 IP 地址的不足之处：**

- IP 地址空间的利用率有时很低。
- 两级 IP 地址不够灵活。

==在这种情况下，将两级IP地址转化为三级IP地址，即将主机号部分分离出前几位作为子网号，对外仍表现为一个网络==。

**子网掩码：**

`两级IP地址：`                                    ![image-20230509150938356](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091509546.png)

`两级 IP 地址的子网掩码：`              ![image-20230509151018379](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091510601.png)

`三级 IP 地址： `                               ![image-20230509151053326](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091510529.png)

`三级 IP 地址的子网掩码：`            ![image-20230509151127065](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091511238.png)

==子网掩码与 IP 地址逐位相与，就得到子网网络地址==

`子网的网络地址： `                            ![image-20230509151323213](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091513396.png)

**使用子网时的分组转发：**

路由表中：

- 目的网络地址
- 目的网络子网掩码
- 下一跳地址

**路由器转发分组的算法：**

- 提取目的 IP 地址
- 是否直接交付
- 特定主机路由
- 检测路由表中有无路径
- 默认路由 0.0.0.0
- 丢弃，报告转发分组出错

#### 转发

##### 无分类编址 CIDR

==无分类域间路由选择 CIDR：==

- **消除了传统的 A 类，B类和 C类地址以及划分子网的概念。**

​	![image-20230509152342006](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091523158.png)

CIDR记法：IP 地址后加上 “/”，然后写上网络前缀（可以任意长度）的位数。如 ==128.14.32.0/20==

- **融合子网地址与子网掩码，方便子网划分**

  CIDR把**网络前缀都相同**的连续的IP地址组成一个“CIDR地址块”。

**构成超网：**

将多个子网聚合成一个较大的子网，叫做`超网`或`路由聚合`。

方法：将网络前缀缩短（所有网络地址取交集）。

![image-20230509152946258](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091529455.png)

**最长前缀匹配：**

使用CIDR时，查找路由表可能得到几个匹配结果（**跟网络掩码按位相与**），应选择具有最长路由的网络前缀的路由。前缀越长，路由越具体。

![image-20230509153344801](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305091533000.png)

##### ARP协议

在主机和路由中都含有ARP高速缓存。ARP协议实现了==IP地址到MAC地址的映射==。

**APR是以广播的形式请求分组**

![image-20230510190027286](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305101900440.png)

![image-20230510185941637](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305101859804.png)

![image-20230510185748179](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305101857440.png)

由于在实际网络的链路上传送数据帧时，最终必须要使用MAC地址。

APR协议：完成主机或路由器IP地址到MAC地址的映射。——解决了下一跳走哪的问题。

==ARP协议的过程==：

检查**ARP高速缓存**，有对应表项则写入MAC帧，没有则用目的MAC地址为FF-FF-FF-FF-FF-FF的帧封装并`广播ARP请求分组`，**同一局域网中**的主机都能收到该请求。目的主机收到请求后就会向源主机==单播一个ARP响应分组==，源主机收到后将此映射**写入APR缓存**（10-20min更新一次）。

**ARP协议的4种典型情况**：

- 主机A发给**本网络**上的主机B：用ARP找到主机B的硬件地址；
- 主机A发给**另一个网络**上的主机B：用ARP找到本网络上的一个路由器（网关）的硬件地址；
- 路由器发给**本网络**的主机A：用ARP找到主机A的硬件地址；
- 路由器发给**另一网络**的主机B：用ARP找到本网络上的一个路由器的硬件地址。

==ARP协议自动执行==

##### DHCP协议

动态主机配置协议DHCP是`应用层`协议，使用`客户/服务器`方式，客户端和服务器通过`广播`方式进行交互，基于`UDP`，DHCP提供**即插即用**联网机制，主机可以从服务器动态获取IP地址、子网掩码、默认网关、DNS服务器名称与IP地址，允许**地址重用**，支持**移动用户加入网络**，支持**在用地址续租**。

**工作方式：**

- 主机广播DHCP**发现**报文——试图找到网络中的服务器，服务器获得一个IP地址。
- DHCP服务器广播DHCP**提供**报文——服务器拟分配给主机一个IP地址及相关配置，先到先得。
- 主机广播DHCP**请求报文**——主机向服务器请求IP地址。
- DHCP服务器广播DHCP**确认**报文——正式将IP地址分配给主机。

##### ICMP协议

==TCP/IP协议栈==

![image-20230510192156887](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305101921067.png)

**网际控制报文协议ICMP**：

ICMP协议支持主机或路由器：差错（或异常）报告，网络探寻——发送特定ICMP报文

![image-20230510192429023](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305101924173.png)

**ICMP差错报告报文类型：**

- 终点不可达：当路由器或主机不能交付数据报时就向源点发送终点不可达报文。（==无法交付==）
- 时间超过：当路由器收到生存时间TTL=0的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。当终点在预定时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，并向源点发送时间超过报文。（==TTL=0==）
- 参数问题：当路由器或目的主机收到的数据报首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文。（==首部字段有问题==）
- 改变路由（重定向）：路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器（==可通过更好的路由器==）

**ICMP差错报告报文数据字段：**

![image-20230510193731131](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305101937331.png)

==是以数据报的形式在网络中传送==

**不应发送ICMP差错报文的情况**：

- 对**ICMP差错报告报文**不再发送ICMP差错报告报文。
- 对第一个分片的数据报的所有**后续数据报片**都不能发送ICMP差错报告报文。
- 对具有**组播地址**的数据报都不发送ICMP差错报告报文。
- 对具有**特殊地址**（如127.0.0.0或0.0.0.0）的数据报不发送ICMP差错报告报文。

**ICMP询问报文：**

- 回送请求和回答报文——主机或路由器向特定目的主机发送的询问，收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。`测试目的站是否可达以及了解其相关状态`。
- 时间戳请求和回答报文——请某个主机或路由器回答当前的日期和时间。`用来进行时钟同步和测量时间`。

**ICMP的应用：**

- ping——测试两个主机之间的连通性，使用了**ICMP回送请求和回答报文**。
- traceroute——跟踪一个分组从源点到终点的路径，使用了**ICMP时间超过报告报文**。

##### IPv6

**IPv6数据报格式：**

![image-20230510194901088](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305101949265.png)

固定`40B`基本首部，路由器处`不能分片`。

![image-20230510195034026](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305101950227.png)

==版本==：指明了协议版本，总是6

==优先级==：区分数据报的类别和**优先级**

==流标签==：“流”是互联网上从特定源点到特定终点的一系列数据报。所有属于同一个流的数据报都具有相同的流标签。

==下一个首部==：标识下一个扩展首部或上层协议首部。

==跳数限制==：相当于IPv4的TTL。

**IPv4和IPv6：**

- IPv6将地址从32位（4B）扩大到`128位（16B）`，更大的地址空间。
- IPv6将IPv4的**校验和字段彻底移除**，以减少每跳的处理时间。
- IPv6将IPv4的可选字段移出首部，变成了`扩展首部`，成为灵活的首部格式，路由器通常不对扩展首部进行检查，大大提高了路由器的处理效率。
- IPv6支持`即插即用`（即自动分配），不需要DHCP协议。
- IPv6首部长度必须是`8B的整数倍`，IPv4首部是`4B`的的整数倍。
- IPv6`只能在主机部处分片`，IPv4可以在路由器和主机处分片。
- IPv6支持资源的预分配，支持实时影像等要求，保证一定的带宽和时延的应用。
- IPv6取消了协议字段，改成下一个首部字段。
- IPv6取消了总长度字段，改用有效载荷长度字段。

**IPv6地址表示形式：**

==一般形式==：冒号十六进制记法

冒号十六进制记法可结合有==点分十进制记法==的后缀（用于IPv4向IPv6过渡）：

**0:0:0:0:0:0:128.10.2.1 或 ::128.10.2.1**



==压缩形式==：

`零压缩`：一连串连续的0可以被一对冒号取代。

FF05:0:0:0:0:0:0:B3——>FF05::B3

==双冒号表示法在一个地址中仅可以出现一次==

**IPv6基本地址类型：**

==单播==：一对一通信   可做源地址+目的地址

==多播==：一对多通信   可做目的地址

==任波==：一对多中的一个通信   可做目的地址

**IPv6向IPv4过度的策略：**

==双栈协议==：双协议站技术就是指在同一台设备上`同时启用IPv4协议栈和IPv6协议栈`。这样，这台设备既能和IPv4网络通信，又能和IPv6网络通信。如果这台设备是一个`路由器`，那么这台路由器的不同接口上，分别配置了IPv4和IPv6地址，并可能分别连接了IPv4网络和IPv6网络。如果这台设备是一个`计算机`，那么它将同时拥有IPv4和IPv6地址，并具备同时处理这两个协议栈的功能。

==隧道技术==：通过使用互联网的基础设施在网络之间传递数据的方式。使用隧道传递的数据（或负载）可以是不同协议的数据帧或包。隧道技术将其他协议的数据帧或包`重新封装`然后通过隧道发送。

##### 移动IP

**移动IP的相关概念：**

移动 IP 技术是移动结点（计算机/服务器等）以`固定的网络IP地址`，实现跨越不同网段的`漫游`功能，并保证了基于网络IP的网络权限在漫游过程中不会发生任何改变。

==移动结点==：具有永久 IP 地址的移动设备。

==归属代理（本地代理）==一个移动结点的永久“居所”称为**归属网络**，在归属网络中代表移动节点执行移动管理功能的实体叫做归属代理。

==永久地址（归属地址/主地址）==：移动站点在归属网络中的原始地址。

==外部代理（外地代理）==：在**外部网络**中帮助移动节点完成移动管理功能的实体称为外部代理。

==转交地址（辅地址）==：可以是外部代理的地址或动态配置的一个地址。

#### 路由选择

##### 路由算法及路由协议

**路由算法的分类**：

- **静态路由算法**（非自适应路由算法）管理员手工配置路由信息。

  ==简单、可靠，在负荷稳定、拓扑变化不大的网络中运行效果很好，广泛应用于高度安全性的军事网络和较小的商业网络==

  ==路由更新慢，不适用于大型网络==

- **动态路由算法**（自适应路由算法）路由器间彼此交换信息，按照路由算法优化出路由表项。

  ==路由更新快，适用于大型网络，及时响应链路费用或网络拓扑变化。==

  ==算法复杂，增加网络负担==。

==动态路由算法==：

- 全局性——链路状态算法  OSPF

  ==所有路由器掌握完整的网络拓扑和链路费用信息==。

- 分散性——距离向量路由算法  RIP

  ==路由器只掌握物理相连的邻居及链路费用==。

**分层次的路由选择协议：**

==原因==：

- 因特网规模很大
- 许多单位不想让外界知道自己的路由选择协议，但还不想连入因特网

**自治系统AS：**

在单一的技术管理下的一组路由器，而这些路由器使用一种AS内部的路由选择协议和共同的度量以确定分组在该AS内的路由，同时还使用一种AS之间的路由协议以确定在AS之间的路由。

一个AS内的所有网络都属于一个行政单位来管辖，一个自治系统的所有路由器在本自治系统的所有路由器在本自治系统内部必须连通。

**内部网关协议：**RIP   OSPF

**外部网关协议**：BGP-4

##### RIP协议及距离向量算法

**RIP协议**:

RIP协议是一种分布式的基于`路由向量`的路由选择协议，是因特网的协议标准，最大的优点是**简单**。

RIP协议要求网络中每一个路由器都维护**从它自己到其他每一个目的网络的唯一最佳距离记录**（即一组距离）。

距离：通常为“跳数”，即从源端口到目的端口所经过的路由器个数，经过一个路由器跳数+1。特别的，从路由器到直接相连的网络距离为1。RIP允许一条路由最多只能包含15个路由器，因此距离为`16表示网络不可达`。

==RIP协议只适用于小型互联网==

![image-20230511090138575](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305110901940.png)

![image-20230511090216439](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305110902600.png)

**RIP协议和谁交换？多久交换一次？交换什么？**

- 仅和`相邻路由器`交换信息。
- 路由器交换的信息是`自己的路由表`。
- `每30秒`交换一次路由信息，然后路由器根据新信息更新路由表。若超过180s还没有收到相邻路由器的通告，则判定“邻居没了”，并更新自己的路由表。

路由器开始工作时，只知道直接相连网路的距离（距离为1），接着每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。经过若干次更新后，所有路由器最终都会知道到达本自治系统任何一个网络的==最短距离==和==下一跳==路由器的地址。即“**收敛**”。

**算法实现过程：**

- 修改相邻路由器发来的RIP报文中的**所有表项**

  对地址为X的相邻路由器发来的RIP报文，修改次报文中的所有项目：把“下一跳”字段中的地址改为X，并把**所有的“距离”字段+1**。

  ![image-20230511091316724](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305110913887.png)

- 对修改后的RIP报文中的每一个项，执行以下步骤：
  - R1路由表中若没有Net3，则把该项填入R1路由表
  - R1路由表中若有Net3，则查看下一跳路由器地址：
    - 若下一跳是X，则用收到的项替换源路由表中的项；
    - 若下一跳不是X，原来距离比从X走的距离远则更新，否则不作处理。
- 若**180s**还没收到相邻路由器X的更新路由表，则把X记为不可达路由器，即把距离设置为16.
- 返回

​	**RIP协议的报文格式：**

![image-20230511092448618](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305110924868.png)

==RIP协议好消息传得快，坏消息传得慢==

**RIP的特点：**当网络出现故障时，要经过比较长的时间才能将此信息传送到所有路由器，**慢收敛**。

如：R1到网1的距离为16，即不可达，但R2不知道R1的更新报文之前仍发送原来的报文，让R1误认为通过R2可以到达网1，于是更新自己的路由表，距离加1，往复几次，直到R1和R2到网1的距离都增大到16时，R1和R2才知网1不可达。

##### OSPF协议及链路状态算法

**开放最短路径优先OSPF协议：**“开放”表明 OSPF 协议不是受一家厂商控制，而是**公开发表**的：“最短路径优先算法”是因为使用了**Dijkstra**提出的**最短路径算法SPF**。

OSPF最主要的特征是使用了分布式的**链路状态协议**。

**OSPF的特点：**

- 使用洪泛法向自治系统内**所有路由器**发送信息，即路由器通过输出端口向所有相邻的路由器发送消息，而每一个相邻路由器又再次将信息发往其所有相邻的路由器。（`广播`）

- 发送的信息就是与本路由器**相邻的所有路由器的链路状态**。（本路由器和哪些路由器相邻，以及该链路的度量/代价——费用、距离、时延、带宽等）

- 只有当**链路状态发生变化时**，路由器才向所有路由器洪泛发送信息。

  ==最后所有路由器都能建立一个链路状态数据库，即全网拓扑图==

**链路状态路由算法：**

- 每个路由器发现它的邻居节点（HELLO问候分组），并了解邻居节点的网络地址。

- 设置到它的每个邻居节点的成本度量 metric。

- 构造【DD数据库描述分组】，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。

- 如果DD分组中的摘要自己都有，则邻站不做处理；如果有没有的或者是更新的，则发送【LSR链路状态请求分组】请求自己没有的和比自己更新的信息。

- 收到邻站的 LSR 分组后，发送【LSU链路状态更新分组】进行更新。

- 更新完毕后，邻站返回一个【LSAck链路状态确认分组】进行确认。

  ==只要有一个路由器的链路状态发生变化==

- 洪泛发送一个【LSU链路状态更新分组】进行更新。
- 更新完毕后，其他站返回一个【LSAck链路状态确认分组】进行确认。
- 使用 Dijkstra 根据自己的链路状态数据库构造到其他节点间的最短路径。

**OSPF的区域：**

为了使OSPF能够用于规模很大的网络，OSPF将一个自治系统再划分为若干个更小的范围，叫做区域。

**OSPF的分组：**==OSPF分组用IP数据报传送==。

**OSPF的其他特点：**

- 每隔30min，刷新一次数据库中的链路信息。
- 由于每个路由器的链路状态只涉及到与相邻路由器的连通状态，因而与整个互联网的规模并无直接关系，因此当`互联网规模很大`时，OSPF协议要比距离向量协议RIP好得多。
- OSPF不存在坏消息传得慢的问题，它的`收敛速度很快`。

##### BGP协议

==和谁交换==：与其他AS内的邻站BGP发言人交换信息。

==交换什么==：交换网络的可达性的信息，即要到达某个网络所要经过的一系列AS。

==多久交换==：发生变化时更新有变化的部分。

![image-20230513122449241](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305131224555.png)

**BGP协议交换信息的过程：**

BGP所交换的网络网络可达性的信息就是要`到达某一个网络所要经过的一系列AS`。当BGP发言人相互交换了网路可达性的信息后，各BGP发言人就根据所采用的策略从收到的路由信息中找出到达各AS的较好路由。

**BGP协议报文格式：**

一个BGP发言人与其他自治系统中的 BGP 发言人要交换的路由信息，就要**先建立TCP连接**，即通过TCP传送，然后在此链接上交换BGP会话，利用BGP会话交换路由信息。

![image-20230513123106312](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305131231581.png)

**BGP协议特点：**

- BGP支持`CIDR`，因此BGP的路由表也就应当包括目的网络的网络前缀、下一跳路由器，以及到达该目的网络所要经过的各个自治系统序列。
-  在 BGP 刚刚运行时，BGP的邻站是交换整个的BGP路由表。但以后只需要在`发生变化时更新有变化的部分`。

**BGP-4的四种报文：**

- ==OPEN（打开）报文==：用来与相邻的另一个BGP发言人建立关系，并认证对方。
- ==UPDATE（更新）报文==：通告新路径或撤销原路径。
- ==KEEPLIVE（保活）报文==：在无UPDATE时，周期性证实邻站的连通性，也作为OPEN的确认。
- ==NOTIFICATION（通知）报文==：报告先前报文的差错，也被用于关闭连接。

**三种协议的比较：**

|   协议   |                    RIP                     |                 OSPF                 |                        BGP                         |
| :------: | :----------------------------------------: | :----------------------------------: | :------------------------------------------------: |
|   类型   |                    内部                    |                 内部                 |                        外部                        |
| 路由算法 |                 距离-路由                  |               链路状态               |                     路径-向量                      |
| 传递协议 |                    UDP                     |                  IP                  |                        TCP                         |
| 路径选择 |                  跳数最少                  |               代价最低               |                    较好、非最佳                    |
| 交换结点 |            和本结点相邻的路由器            |          网络中的所有路由器          |                和本结点相邻的路由器                |
| 交换内容 | 当前本路由器知道的全部信息，即自己的路由表 | 与本路由器相邻的所有路由器的链路状态 | 首次：交换整个路由表<br />非首次：交换有变化的部分 |

##### IP组播

**数据报的三种传输方式：**

- ==单播==

  单播用于发送数据包到单个目的地，且每发送一份单播报文都使用一个单播IP地址作为目的地址。是一种`点对点`传输方式。

- ==广播==

  广播是指发送数据包到同一个广播域或子网内的所有设备的一种数据传输方式，时一种`一点对多点的传输方式`。

- ==组播（多播）==

  当网络中的某些用户需要特定数据时，组播数据发送者仅需发送一次数据，借助组播路由协议为组播数据包建立组播分发树，被传递的数据到达距离用户端尽可能近的节点后才开始复制和分发，是一种`一点对多点`的传输方式。

**IP组播地址：**

IP组播地址让源设备能够将分组发送给一组设备。属于多播组的设备将被分配**一个组播组IP地址**（==一群共同需求的主机的相同标识==）

组播地址范围为 224.0.0.0 ~ 239.255.255.255（D类地址），一个D类地址表示一个组播组。只能用作分组的`目的地址`。源地址总是为**单播地址**。

- 组播地址数据报也是**尽最大努力交付**，不提供可靠交付，应用于 UDP。
- 对组播数据报不产生 ICMP 差错报文。
- 并非所有 D 类地址都可以作为组播地址。

**硬件组播：**

同单播地址一样，组播IP地址也需要相应的组播 MAC 地址在为本网络中实际传送帧。组播 MAC 地址以十六进制值 01-00-5E 打头，余下的6个十六进制位是根据 IP 组播地址的最后23位转换得到的。

TCP/IP协议使用的以太网多播地址的范围是：

==01-00-5E-00-00-00 到 01-00-5E-7F-FF-FF==

![image-20230513130648745](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305131306954.png)

**IGMP协议与组播路由选择协议：**

**网际组管理协议 IGMP**：

 IGMP 协议让路由器知道本局域网上**是否有主机（的进程）参加或退出了某个组播组**。

![image-20230513131122697](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305131311851.png)

ICMP 和 IGMP 都使用 **IP数据报**传递报文。

**IGMP工作的两个阶段：**

- 某主机要加入组播组时，该主机像组播组的组播地址发送一个 IGMP 报文，声明自己要成为该组的成员。

  本组播路由器收到 IGMP 报文后，要利用组播路由选择协议把该组成员关系发送给因特网上的其他组播路由器。

- 本组播地址路由器周期性的探寻本局域网上的主机，以便知道这些主机是否还是该组播组的成员。

  只要有一个主机对某个组响应，那么组播路由器就认为这个组是活跃的，否则，经过几次探寻后没有一个主机响应，则认为本网络上没有此组播的成员，因此就不再把该组成员关系发送给其他的组播路由器。

**组播路由选择协议：**

组播路由协议目的是找出以源主机为根结点的**组播转发树**。

构造树可以避免在路由器之间兜圈子。

对不同的多播组对应于不同的多播转发树；同一个多播组，对不同的源点也会有不同的多播转发树。

![image-20230513132244892](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305131322179.png)

**组播路由选择协议常使用的三种算法：**

- 基于链路状态的路由选择
- 基于距离-向量的路由选择
- 协议无关的组播（稀疏/密集）

### 第五章 传输层

#### 传输层的概述

##### 传输层的功能

- 传输层提供进程和进程之间的逻辑通信
- 复用和分组
- 传输层对收到的报文进行差错检测
- 传输层的两种协议

##### 面向连接的传输控制协议 TCP

传送数据之前必须建立连接，数据传送结束之后要释放连接。不提供广播或多播服务。由于 TCP 要提供可靠的面向连接的服务，因此不可避免的增加了很多开销：确认、流量控制、计时器及连接管理。

**特点：**==可靠，面向连接，时延大，适用于大文件==。

##### 无连接的用户数据报协议 UDP

传送数据之前不需要建立连接，收到 UDP 报文后也不需要给出任何确认。

**特点：**==不可靠，无连接，时延小，适用于小文件==。

##### 传输层的寻址与端口

**复用：**应用层所有的应用进程都可以通过传输层再传输到网络层。

**分用：**传输层从网络层收到数据报后交付指明的应用进程。

==端口==用来标识主机的应用进程

端口号只有本地意义，在因特网中不同计算机的相同端口是没有联系的。端口号长度为16bit，能表示65536个不同的端口号。

**端口号（按范围分）**

- **服务端**使用的端口号
  - 熟知端口号：给 TCP/IP 最重要的的一些应用程序，让所有用户都知道 `0~1023`
  - 登记端口号：为没有熟知端口号的应用程序使用的。 `1024~49151`
- **客户端**使用的端口号：仅在客户端运行时才动态选择的端口号。`49152~65535`

**常见端口号对应的应用程序：**

|  应用程序  | FTP  | TELNET | SMTP | DNS  | TFTP | HTTP | SNMP |
| :--------: | :--: | :----: | :--: | :--: | :--: | :--: | :--: |
| 熟知端口号 |  21  |   23   |  25  |  53  |  69  |  80  | 161  |

在网络中采用发送方和接收方的套接字组合来识别端点，**套接字**唯一标识了网络中的一个主机和它上面的一个进程。

==套接字Socket=（主机 IP 地址，端口号）==

#### UDP协议

##### 用户数据报协议 UDP 概述

UDP只在IP数据报服务之上增加了很少的功能，即复用分用和差错检测功能。

**UDP 的主要特点：**

- UDP 是**无连接**的，减少开销和发送数据之前的时延。
- UDP 使用最大努力交付，即**不保证可靠交付**。
- UDP 是**面向报文**的，适合一次性传输少量数据的网络应用。
- UDP 无拥塞控制，适合很多实时应用。、
- UDP 首部开销小，`8B`，TCP`20B`。

![image-20230515193014961](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305151930232.png)

应用层给 UDP 多长的报文，UDP就照样发送，即一次发送完一整个报文。

##### UDP首部格式

​	![image-20230515193209347](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305151932495.png)

分用时，如果找不到对应的目的端口，就丢弃报文，并给发送方发送 ICMP “端口不可达”差错报告报文。

##### UDP 校验

![image-20230515193408137](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305151934293.png)

伪首部只有在计算检验和时才出现，不向下传送也不向上递交。

==17==：封装 UDP 报文的 IP 数据报首部协议字段是 17。

==UDP长度==：UDP首部 8B + 数据部分长度（不包括伪首部）

**如何校验：**

![image-20230515193732016](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305151937166.png)

==在发送端==：

- 填上伪首部
- 全 0 填充检验和字段
- 全 0 填充数据部分（UDP 数据报要看成许多 4B 的字串接起来）
- 伪首部+首部+数据部分采用二进制反码求和
- 把和求反码填入检验和字段
- 去掉伪首部，发送

==在接收端==：

- 加上伪首部
- 伪首部+首部+数据部分采用二进制反码求和
- 结果全为1则无差错，否则丢弃数据报/交给应用层附上差错的警告

#### TCP 协议特点 和 TCP 报文段

##### **TCP 协议特点**

- TCP 是面向连接（虚连接）的传输层协议。
- 每一条 TCP 连接只能有两个端点，每一条 TCP 连接只能是点对点的。
- TCP 提供可靠交付的服务，无差错、不丢失、不重复、按序到达。
- TCP 提供全双工通信。
  - 发送缓存：==准备发送的数据和已发送但尚未收到确认的数据==
  - 接收缓存：==按序到达但尚未被接受应用程序读取的数据和不按序到达的数据==
- TCP 面向字节流：TCP 把应用程序交下来的数据看成仅仅是一连串的`无结构的字节流`。

==流==：流入到进程或从进程流出的字节序列。

##### TCP报文段首部格式

![image-20230515195258673](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305151952827.png)

==序号==：在一个TCP连接中传送的字节流中的每一个字节都按顺序编号，本字段表示本报文段所发送数据的`第一个字节的序号`。

==确认号==：`期望`收到对方下一个报文段的第一个数据字节的序号。若确认号为 N，则证明到序号 N-1为止的所有数据都以正确收到。

==数据偏移（首部长度）==：TCP报文段的数据起始处距离TCP报文段的起始处有多远，以 4B 为单位。

==紧急位 URG==：URG=1时，标明此报文段中有紧急数据，是高优先级的数据，应该尽快传送，不用在缓存里排队，配合紧急指针使用。

==确认位 ACK==：ACK=1时确认号有效，在连接建立后所有传送的报文段都必须把ACK置为1。

**推送位PSH：**PSH=1时，接收方尽快交付接收应用进程，不再等到缓存填满在向上交付。

**复位RST：**RST=1时，表明 TCP 连接中出现严重差错，必须释放连接，然后再重新建立传输连接。

==同步位SYN==：SYN=1时，表明是一个连接请求/连接接受报文。

==终止位 FIN==：FIN=1时，表明此报文段发送方数据已发完，要求释放连接。

==窗口==：指的是发送本报文段的一方的接收窗口，即现在允许对方发送的数据量。

==检验和==：检验首部+数据，检验时要加上12B的伪首部。

==紧急指针==：URG=1时才有效，指出本报文段中紧急数据的字节数。

==选项==：最大报文段长度MSS、窗口扩大、时间戳、选择确认…

##### TCP 连接管理

**TCP 连接传输的三个阶段：**

==三次握手==

==建立连接==——>==数据传送==——>==连接释放==

TCP 连接的建立采用`客户服务器方式`，主动发起连接建立的应用进程叫做客户，而被动等待连接建立的应用进程叫服务器。

**TCP的连接建立：**

假设运行在一台主机（客户）上的一个进程相与另一台主机（服务器）上的一个进程建立一条连接，客户应用进程首先通知客户 TCP，他想建立一个与服务器上的某个进程之间的连接，客户中的 TCP 会用以下步骤与服务器中的 TCP 建立一条 TCP 连接。

![image-20230515201954855](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305152019014.png)

==ROUND 1==:

客户端发送**连接请求报文段**，无应用层数据。  SYN=1,，seq=x（随机）

==ROUND 2==：

服务器端为该 TCP 连接**分配缓存和变量**，并向客户端返回**确认报文**，允许连接，无应用层数据。

SYN=1，ACK=1，seq=y（随机），ack = x+1

==ROUND 3==：

客户端为该 TCP 连接**分配缓存和变量**，并向服务器返回确认的确认，可以携带数据。

SYN=1，ACK =1，seq = x + 1，ack = y+1

##### TCP 连接释放

==四次握手==

参与一条 TCP 连接的两个进程中的任何一个都能终止该连接，连接结束后，主机中的“资源”（缓存和变量）将被释放。

![image-20230515203057525](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305152030677.png)

==ROUND 1==：

客户端发送**释放连接报文段**，停止发送数据，主动关闭TCP连接。FIN=1，seq=u。

==ROUND 2==：

服务器端返回一个确认报文段，客户到服务器这个方向的连接就释放了——半关闭状态。

ACK =1，seq=v，ack=u+1

==ROUND 3==：

服务器发完数据，就发出连接释放报文段，主动关闭 TCP 连接。

FIN=1，ACK=1，seq=w，ack=u+1

==ROUND 4==：

客户端回送一个确认报文段，在等待到时间等待计时器设置的 2MSL （最长报文段寿命）后，连接彻底关闭。

ACK=1，seq=u+1，ack=w+1

##### TCP 可靠传输

==可靠==：保证接收方进程从缓存区读出的字节流与发送方读出的字节流是完全一样的。

**TCP 实现可靠传输的机制：**

`校验`、`序号`、`确认`、`重传`

==序号==

![image-20230515204135072](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305152041257.png)

==确认==

![image-20230515204237074](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305152042248.png)

==重传==

TCP的发送端在**规定时间**内没有收到确认就要重传已发出的报文段。`超时重传`

TCP 采用自适应算法，动态改变重传时间 RTTs（加权平均往返时间）

**冗余 ACK（冗余确认）**

如果接收方收到**3个对于同一报文段的冗余ACK**，则可确认这一报文段的下一报文段丢失，可快速重传。

##### TCP流量控制

流量控制：让**发送方慢点**，要让接收方来得及接收。

TCP利用滑动窗口机制来实现流量控制。

在通信过程中，接收方根据自己**接收缓存的大小**，动态的调整发送方的发送窗口大小，及接收窗口rwnd，发送方的**发送窗口取`接收窗口`rwnd和`拥塞窗口`cwnd的最小值**。

##### TCP拥塞控制

出现拥塞的条件：对资源需求的总和 > 可用资源

网络中有许多资源同时呈现供应不足——>网络性能变坏——>网络吞吐量将随着输入负载增大而下降。

网络控制：防止过多的数据注入到网络中。

==拥塞控制的四种算法==

- 慢开始
- 拥塞避免
- 快重传
- 快恢复

假定：

- 数据单方向传送，而另一个方向只传送确认

- 接收方总是有足够大的缓存空间，因而发送窗口大小取决于拥塞程度

  发送窗口 = Min{接收窗口 rwnd，拥塞窗口 cwnd}

**接收窗口：**接收方根据接收缓存设置的值，并告知给发送方，反映接收方容量。

**拥塞窗口：**发送方根据自己估算的网络拥塞程度而设置的窗口值，反映网络当前容量。

==慢开始和拥塞避免==

![image-20230515210432312](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305152104524.png)

**一个传输轮次：**

发送了一批报文段并收到它们确认的时间。（一个往返时延 RTT）（开始发送一批拥塞窗口内的报文段到开始发送下一批拥塞窗口内的报文段）

==快重传和快恢复==

![image-20230515210856506](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305152108664.png)

### 第六章 应用层

#### 网络应用模型

- 客户/服务器模型（Client/Server）
- P2P模型（Peer-to-Peer）

##### 应用层概述

应用层对应用进程的通信提供服务。

**应用层的`功能`**：

- 文件传输
- 电子邮件
- 虚拟终端
- 查询服务和远程作业登录

**应用层的`重要协议`**：FTP、SMTP、POP3、HTTP、DNS

##### 客户/服务器模型（c/s）

==服务器==：**提供计算服务**的设备。

==客户机==：**请求计算服务**的主机

应用：Web、文件传输FTP、远程登陆、电子邮件

##### P2P模型（对等模型）

![image-20230515213348187](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305152133341.png)

- 不存在永远在线的服务器
- 每个主机既可以**提供服务**，也可以**请求服务**
- 任意端系统/节点之间可以**直接通信**
- 节点间歇性接入网络
- 节点可能改变 IP 地址
- 可扩展性好
- 网络健壮性强

#### 应用程序相关

##### 域名解析系统 DNS

**功能：**将域名解析成IP地址

**域名：**

- 根
- 顶级域名
  - 国家顶级域名  cn, us, uk
  - 通用顶级域名  com,net,org,gov,int,aero,museum,travel
  - 基础结构域名/反向域名  arpa
- 二级域名
  - 类域别名  ac,com,edu,gov,mil,net,org
  - 行政区域名  用于我国各省、自治区、直辖市 bj
- 三级域名
- 四级域名 

![image-20230516141101118](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161411717.png)

**域名服务器：**

![image-20230516141412411](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161414599.png)

本地域名服务器：当一个主机发出 DNS 查询请求时，这个查询请求报文就发给本地域名服务器。

##### 域名解析过程

- 递归查询（靠别人）
- 迭代查询（靠自己）

![image-20230516141734605](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161417031.png)

##### 文件传输协议 FTP

**功能：**提供不同种类主机系统（硬、软件体系等都可以不同）之间的文件传输能力。

简单文件传输协议 TFTP（Trivial File Transfer Protocol）

支持==下载==和==上传==

**FTP 服务器和用户端：**

FTP 是基于客户/服务器（c/s）的协议

用户通过一个客户机程序连接至远程计算机上运行的服务器程序。

依照 FTP 协议提供服务，进行文件传送的计算机就是**FTP服务器**

连接 FTP 服务器，遵循 FTP 协议与服务器传送文件的电脑就是**FTP客户端**

**FTP 的工作原理：**

FTP 使用 TCP 实现可靠传输

![image-20230516143022530](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161430711.png)

**控制**连接`始终`保持

**数据**连接保持一会

是否使用TCP20端口建立**数据连接**与**传输模式**有关

- `主动`方式使用 TCP 20端口
- `被动`方式由服务器和客户端自行协商决定（端口 > 1024）

==FTP 传输模式==：

- 文本模式：ASCII模式，以文本序列传输数据
- 二进制模式：Binary模式，以二进制序列传送数据

##### 电子邮件

**电子邮件的信息格式：**

![image-20230516143446171](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161434361.png)

**组成结构：**

![image-20230516143637429](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161436820.png)

![image-20230516143726153](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161437475.png)

**简单邮件传送协议SMTP**

SMTP 规定了在两个相互通信的**SMTP进程**之间应该如何交换信息。

负责发送邮件的 SMTP 进程就是 **SMTP客户**，负责接收邮件的进程就是**SMTP服务器**

SMTP 规定了14条命令（几个字母）和21种应答信息（三位数字代码+简单文字说明）

==SMTP 通信的三个阶段==：

==连接建立==——>==邮件发送==——>==连接释放==

**MIME**

**STMP的缺点：**

- SMTP 不能发送可执行文件或者其他二进制对象
- SMTP 仅限于传送7位ASCII码，不能传送其他非英语国家的文字。
- SMTP 服务器会拒绝超过一定长度的邮件。

==通用因特网邮件扩充 MIME==

![image-20230516144828860](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161448065.png)

**邮局协议POP3**

使用 `TCP连接`  `端口号`   `C/S`

![image-20230516144959423](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161449735.png)

POP3工作方式：

- 下载并保留（在服务器）
- 下载并删除

**网际报文存取协议IMAP**

IMAP 协议比 POP协议复杂。当用户PC 上的 IMAP 客户程序打开 IMAP服务器的邮箱时，用户可以看到邮箱的首部，若用户需要打开某个邮件，该邮件才能上传到用户的计算机上。

IMAP 可以让用户在不同的地方使用不同的计算机随时上网阅读处理邮件，还允许只读取邮件中的某个部分。

**基于万维网的电子邮件**

![image-20230516145524323](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161455646.png)

##### 万维网和 HTTP协议

**万维网概述**

万维网WWW（World Wide Web）是一个大规模的、联机式的信息储藏所/**资料空间**，是无数个网络站点和网页的集合。

**统一资源定位符 `URL`可以唯一标识网络上的资源**

**HTTP协议的特点：**

- HTTP协议是**无状态的**
- 如果想存储用户信息，可以使用 Cookie
- HTTP采用 TCP 作为运输层的协议，但`HTTP协议本身是无连接`的（通信双方在交换HTTP报文之前不需要先建立HTTP连接）。

HTTP的连接方式

- 持久连接——Keep-alive（在连接过程中 TCP只需连接一次）
  - 非流水线
  - 流水线
- 非持久连接——Close（一次请求需建立一次 TCP 连接）

**报文格式：**

HTTP报文：是**面向文本**的，因此在报文中的每一个字段都是一些ASCII码串。

- 请求报文
- 响应报文

![image-20230516151201617](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161512030.png)

**报文结构**

![image-20230516151606753](https://imagesimages-1317416276.cos.ap-nanjing.myqcloud.com/image/202305161516150.png)
